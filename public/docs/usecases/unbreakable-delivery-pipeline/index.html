<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Unbreakable Delivery Pipeline - keptn</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google-site-verification" content="wDzKASaTgmwGTtV-z_O-NU_6e1wOgA7spKT96o9r8XE" />
  
  <link rel="icon" href="https://keptn.sh/favicon.png">

  
  
  <link rel="stylesheet" href="/css/style.min.821919e21a897e2d44560dc93ae95d622a07179547d0969419b46936cfcf90b5.css">
  <link rel="stylesheet" href="/js/libs/doc/lightbox/css/lightbox.min.min.1bbb47ec548f1c47e276ce27971cdc27f8c803ee4bb96f064c72c7448f7c0f12.css">
  
  <script>
    var branchName = "";
    var docTitle = "Unbreakable Delivery Pipeline";
    var iconFile = "https:\/\/keptn.sh\//img/icons.svg";
    var buttonCopy = '';
    var buttonPrint = '';
    var buttonDownload = '';
  </script>
</head>

<body class='page '>
  
<div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-docs">
      <a href="/docs/">
        
        <span>Docs</span>
      </a>
    </li>
    
  </ul>
</div>

  <div class="wrapper">

    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="https://keptn.sh/"><img alt="Keptn Homepage" src="https://keptn.sh/images/logo.svg" /></a>
    </div>
    <div class="logo-mobile">
      <a href="https://keptn.sh/"><img alt="Keptn Homepage" src="https://keptn.sh/images/logo-mobile.svg" /></a>
    </div>
    
<div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-docs">
      <a href="/docs/">
        
        <span>Docs</span>
      </a>
    </li>
    
  </ul>
</div>

    
<button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" role="presentation" aria-label="mobile menu trigger">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>

  </div>
</div>
    <a href="https://github.com/keptn/" class="github-corner" aria-label="Keptn on GitHub">
  <svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true">
    <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z" fill="#151513"></path>
    <path class="octo-arm" d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="#ffffff" style="transform-origin: 130px 106px;"></path>
    <path class="octo-body" d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="#ffffff"></path>
  </svg>
</a>
    <div class="container">
      




    <div class="primary">


    <div id="sidebar-container" class="sidebar-container sidebar-offcanvas">
        
        
            <nav class="sidebar">
    <div class="spacer"></div>
    <div class="directory" role="tablist">
        

        
        

        
            
        
            
        
            

                <div class="card">
                    <div class="card-header" role="tab" id="header2">
                        <a data-toggle="collapse" href="#collapse2" title="How to deploy keptn in Kubernetes." role="button" aria-controls="collapse2">
                            <div><svg class="icon"><use xlink:href="/img/icons.svg#setup"/></svg>Setup</div>
                        </a>
                    </div>

                    <div id="collapse2" class="collapse" role="tabpanel" aria-labelledby="header2">
                        <div class="card-body">
                            




<ul class="tree">
    
        
    
        
            
                <li class="sublist">
                    

                    <label class='tree-toggle'><i class="chevron show"><svg class="icon"><use xlink:href="/img/icons.svg#right-chevron"/></svg></i><i class="chevron"><svg class="icon"><use xlink:href="/img/icons.svg#down-chevron"/></svg></i><a  title="Instructions for installing keptn on Kubernetes." href="https://keptn.sh/docs/setup/kubernetes/">Kubernetes</a>
                    </label>

                    




<ul class="tree collapse">
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            
                <li>
                    
                        <a title="Demonstrates how to install keptn in a Kubernetes cluster on Google Container Engine (GKE)." href="https://keptn.sh/docs/setup/kubernetes/install-keptn-v.0.1/">Install keptn v.0.1 on GKE</a>
                    
                </li>
             
        
    
</ul>

                </li>
            
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
</ul>

                        </div>
                    </div>
                </div>
            
        
            
        
            
        
            
        
            
        
            

                <div class="card">
                    <div class="card-header" role="tab" id="header7">
                        <a data-toggle="collapse" href="#collapse7" title="How to do specific targeted activities with keptn." role="button" aria-controls="collapse7">
                            <div><svg class="icon"><use xlink:href="/img/icons.svg#tasks"/></svg>Use Cases</div>
                        </a>
                    </div>

                    <div id="collapse7" class="collapse show" role="tabpanel" aria-labelledby="header7">
                        <div class="card-body">
                            




<ul class="tree">
    
        
    
        
    
        
    
        
            
                <li>
                    
                        <a title="Shows you how to setup a fully automated on-demand self-service model for performance testing." href="https://keptn.sh/docs/usecases/performance-as-a-service/">Performance as a Service</a>
                    
                </li>
             
        
    
        
            
                <li>
                    
                        <a title="Gives an overview of production deployments, deployment strategies, and depicts those using Istio on Kubernetes to canary-deploy a new front-end version." href="https://keptn.sh/docs/usecases/production-deployments/">Production Deployments</a>
                    
                </li>
             
        
    
        
            
                <li>
                    
                        <a title="Gives an overview of how to leverage the power of runbook automation to build self-healing applications. Therefore, you will use Ansible Tower as the tool for executing and managing the runbooks." href="https://keptn.sh/docs/usecases/runbook-automation-and-self-healing/">Runbook Automation and Self-healing</a>
                    
                </li>
             
        
    
        
            
                <li>
                    
                        <span class="current" title="Shows you how to implement a delivery pipeline that prevents bad code changes from impacting your end users.">Unbreakable Delivery Pipeline</span>
                    
                </li>
             
        
    
        
    
        
    
</ul>

                        </div>
                    </div>
                </div>
            
        
            
        

        
            
        
    </div>
</nav>

        
    </div>

    <div class="article-container">
        
            <label class="sidebar-toggler" id="sidebar-toggler" title=''>
                <svg class="icon"><use xlink:href="/img/icons.svg#pull"/></svg>
            </label>
        

        <div class="pagenav">
            <p>


    
        
        
        
    

    
        
        
        
    

    
        
        
        
    

    
        
        
        
    




    
    
    

    
        <a href="https://keptn.sh/">Home</a>
        <span>/</span>
    

    
    
    

    
        <a href="https://keptn.sh/docs/">Docs</a>
        <span>/</span>
    

    
    
    

    
        <a href="https://keptn.sh/docs/usecases/">Use Cases</a>
        <span>/</span>
    

    
    
    

    
        Unbreakable Delivery Pipeline
    

</p>
        </div>

        <main aria-labelledby="title">
            <h1 id="title">Unbreakable Delivery Pipeline</h1>

            

            
                <p class="byline"><span title="%!(EXTRA int=1739)"><svg class="icon"><use xlink:href="/img/icons.svg#clock"/></svg><span>&nbsp;</span>%!(EXTRA int=9)</span></p>
            

            
                <nav class="toc-inlined">
                    <hr/>
                    <div class="directory" role="directory">
                        





    







    
    

    
        
        <nav id="InlinedTableOfContents">
            <ul>
                
                
                    
                    
                    
                    

                    

                    <li><a href="#about-this-use-case">About this use case</a></li>

                    
                
                    
                    
                    
                    

                    

                    <li><a href="#step-1-simulate-an-early-pipeline-break">Step 1: Simulate an early pipeline break</a></li>

                    
                
                    
                    
                    
                    

                    

                    <li><a href="#step-2-setup-self-healing-action-for-production-deployment">Step 2: Setup self-healing action for production deployment</a></li>

                    
                
                    
                    
                    
                    

                    

                    <li><a href="#step-3-introduce-a-failure-into-front-end-and-deploy-to-production">Step 3: Introduce a failure into front-end and deploy to production</a></li>

                    
                
                    
                    
                    
                    

                    

                    <li><a href="#step-4-simulate-a-bad-production-deployment">Step 4. Simulate a bad production deployment</a></li>

                    
                
                    
                    
                    
                    

                    

                    <li><a href="#step-5-cleanup">Step 5. Cleanup</a></li>

                    
                
                    
                    
                    
                    

                    

                    <li><a href="#understanding-what-happened">Understanding what happened</a></li>

                    
                

                
                

                
                    
                        <li><a href="#see-also">See also</a></li>
                    
                
            </ul>
        </nav>
    


                    </div>
                    <hr/>
                </nav>
            



<p>This use case shows how to implement a delivery pipeline that prevents bad code changes from impacting your end users.</p>

<h2 id="about-this-use-case">About this use case</h2>

<p>The initial goal of the <em>Unbreakable Delivery Pipeline</em> is to implement a pipeline that prevents bad code changes from impacting your end users. This pipeline relies on three concepts known as Shift-Left, Shift-Right, and Self-Healing.</p>

<ul>
<li><p><strong>Shift-Left</strong>: Ability to pull data for specific entities (processes, services, or applications) through an automation API and feed it into the tools that are used to decide on whether to stop the pipeline or keep it running.</p></li>

<li><p><strong>Shift-Right</strong>: Ability to push deployment information and meta data to your monitoring solution (e.g., to differentiate BLUE vs GREEN deployments), to push build or revision number of a deployment, or to notify about configuration changes.</p></li>

<li><p><strong>Self-Healing</strong>: Ability for smart auto-remediation that addresses the root cause of a problem and not the symptom.</p></li>
</ul>

<p>To illustrate the scenario this use case addresses, two steps are required:</p>

<ol>
<li><p>The source code of a service of the <a href="https://github.com/dynatrace-sockshop">Dynatrace Sockshop</a> will be changed, and the service gets deployed to the development environment. Although the service passes the quality gates in the development environment, the service does not pass the quality gate in staging due to an increase of the response time detected by a performance test. This demonstrates an early break of the delivery pipeline based on automated quality gates.</p></li>

<li><p>For showing the self-healing capabilities, a faulty service version is deployed to the production environment and traffic is routed to this new version. Consequently, an issue is detected in production and a problem ticket is opened. To auto-remediate the bad deployment, the traffic routing is changed to redirect traffic to the previous (non-faulty) version.</p></li>
</ol>

<h2 id="step-1-simulate-an-early-pipeline-break">Step 1: Simulate an early pipeline break</h2>

<p>In this step you&rsquo;ll release a service to staging that is not tested based on performance tests. Intentionally, the service is slowed down to fail at the end-to-end check in the staging pipeline.</p>

<ol>
<li><p>Introduce a slowdown in the carts service.</p>

<ol>
<li>In the directory of <code>~/keptn/repositories/carts/</code>, open the file: <code>./src/main/resources/application.properties</code></li>
<li>Change the value of <code>delayInMillis</code> from <code>0</code> to <code>1000</code></li>

<li><p>Commit/Push the changes to your GitHub Repository <em>carts</em></p>

<pre><code class="language-console">$ git add .
$ git commit -m &quot;Property changed&quot;
$ git push
</code></pre></li>
</ol></li>

<li><p>You need the new version of the carts service in the staging namespace. Therefore, create a new release branch in the carts repository using the Jenkins pipeline <code>create-release-branch</code>:</p>

<ol>
<li>Go to <strong>Jenkins</strong> and <strong>sockshop</strong>.</li>
<li>Click on <strong>create-release-branch</strong> pipeline and <strong>Schedule a build with parameters</strong>.</li>

<li><p>For the parameter <strong>SERVICE</strong>, enter the name of the service you want to create a release for. In this case: <strong>carts</strong></p>

<p>The pipeline does the following:</p>

<ol>
<li>Reads the current version of the microservice.</li>
<li>Creates a release branch with the name release/<strong>version</strong>.</li>
<li>Increments the current version by 1.</li>
<li>Commits/Pushes the new version to the Git repository.</li>
</ol>

<p><img src="./assets/pipeline_release_branch.png" alt="pipeline_release_branch" /></p></li>
</ol></li>

<li><p>After the <code>create-release-branch</code> pipeline has finished, trigger the build pipeline for the carts release and follow the pipeline:</p>

<ol>
<li>Go to <strong>sockshop</strong>, <strong>carts</strong>, and click on <strong>Scan Multibranch Pipeline Now</strong>.</li>
<li>Open the release build by clicking on the <strong>#no</strong>.</li>
<li>In the <strong>Console Output</strong> wait for <em>Starting building: k8s-deploy-staging</em> and click on that link.</li>
<li>The pipeline should fail due to a too high response time.</li>

<li><p>Click on <strong>Performance Report</strong> to see the average response time of the URI: <em>_cart - add to cart</em></p>

<p><img src="./assets/break_early.png" alt="break_early" /></p></li>
</ol></li>

<li><p>Remove the slowdown in the carts service</p>

<ol>
<li>In the directory of <code>~/keptn/repositories/carts/</code>, open the file: <code>./src/main/resources/application.properties</code></li>
<li>Change the value of <code>delayInMillis</code> from <code>1000</code> to <code>0</code></li>

<li><p>Commit/Push the changes to your GitHub Repository <em>carts</em></p>

<pre><code class="language-console">$ git add .
$ git commit -m &quot;Set delay to 0&quot;
$ git push
</code></pre></li>
</ol></li>

<li><p>Build this new release</p>

<ol>
<li>Go to <strong>Jenkins</strong> and <strong>sockshop</strong>.</li>
<li>Click on <strong>create-release-branch</strong> pipeline and <strong>Schedule a build with parameters</strong>.</li>
<li>For the parameter <strong>SERVICE</strong>, enter the name of the service you want to create a release for. In this case: <strong>carts</strong></li>
<li>After the create-release-branch pipeline has finished, trigger the build pipeline for the carts release.</li>
</ol></li>
</ol>

<h2 id="step-2-setup-self-healing-action-for-production-deployment">Step 2: Setup self-healing action for production deployment</h2>

<p>In this step you will use an Ansible Tower job to release a deployment in a canary release manner. Additionally, you will create a second job that switches back to the old version in case the <em>canary</em> (i.e., the new version of front-end) behaves wrong.</p>

<ol>
<li><p>Login to your Ansible Tower instance.</p>

<p>Receive the public IP from your Ansible Tower:</p>

<pre><code class="language-console">$ kubectl get services -n tower
NAME            TYPE           CLUSTER-IP       EXTERNAL-IP     PORT(S)         AGE
ansible-tower   LoadBalancer   ***.***.***.**   xxx.143.98.xxx   443:30528/TCP   1d
</code></pre>

<p>Copy the <code>EXTERNAL-IP</code> into your browser and navigate to <a href="https://xxx.143.98.xxx">https://xxx.143.98.xxx</a></p></li>

<li><p>(If you haven&rsquo;t entered the license yet, see <a href="../runbook-automation-and-self-healing#step-1-verify-installation-of-ansible-tower-">submit the Ansible Tower license</a>.)</p></li>

<li><p>(If you haven&rsquo;t integrated Ansible Tower into Dynatrace, see <a href="../runbook-automation-and-self-healing#step-2-integration-ansible-tower-runbook-in-dynatrace-">Integration Ansible Tower runbook in Dynatrace</a>.)</p></li>

<li><p>Your login is:</p>

<ul>
<li>Username: <code>admin</code></li>
<li>Password: <code>dynatrace</code></li>
</ul></li>

<li><p>Verify the existing job template for canary release in Ansible Tower by navigating to <strong>Templates</strong> and <strong>canary</strong>.</p>

<ul>
<li>Name: <code>canary</code></li>
<li>Job Type: <code>Run</code></li>
<li>Inventory: <code>inventory</code></li>
<li>Project: <code>self-healing</code></li>
<li>Playbook: <code>scripts/playbooks/canary.yaml</code></li>
<li>Skip Tags: <code>canary_reset</code></li>
<li>Extra Variables:
<code>
---
jenkins_user: &quot;admin&quot;
jenkins_password: &quot;AiTx4u8VyUV8tCKk&quot;
jenkins_url: &quot;http://1**.2**.3**.4**/job/k8s-deploy-production-canary/build?delay=0sec&quot;
remediation_url: &quot;https://5**.6**.7**.8**/api/v2/job_templates/xx/launch/&quot;
</code></li>
<li>Remarks:

<ul>
<li>The IP <code>1**.2**.3**.4**</code> in jenkins_url is the IP of your Jenkins.</li>
<li>The IP <code>5**.6**.7**.8**</code> in remediation_url is the IP of your Ansible Tower.</li>
<li>The <code>xx</code> before <code>/launch</code> is the ID of the job shown in the next step.</li>
</ul></li>
</ul>

<p>After this step, your job template for <em>canary</em>  should look as shown below:
<img src="./assets/ansible_template_1.png" alt="ansible_template_1" /></p></li>

<li><p>Verify the existing job template for canary-reset in Ansible Tower by navigating to <strong>Templates</strong> and <strong>canary-reset</strong>.</p>

<ul>
<li>Name: <code>canary-reset</code></li>
<li>Job Type: <code>Run</code></li>
<li>Inventory: <code>inventory</code></li>
<li>Project: <code>self-healing</code></li>
<li>Playbook: <code>scripts/playbooks/canary.yaml</code></li>
<li>Job Tags: <code>canary_reset</code></li>
<li>Remarks:

<ul>
<li>The IP <code>1**.2**.3**.4**</code> in jenkins_url is the IP of your Jenkins.</li>
</ul></li>
</ul>

<p>After this step, your job template for <em>canary reset</em> should look as shown below:
<img src="./assets/ansible_template_2.png" alt="ansible_template_2" /></p></li>
</ol>

<h2 id="step-3-introduce-a-failure-into-front-end-and-deploy-to-production">Step 3: Introduce a failure into front-end and deploy to production</h2>

<p>In this step you will introduce a Java Script error into the front-end service. This version will be deployed as version <code>v2</code>.</p>

<ol>
<li><p>Open the file <code>server.js</code> in the master branch of the <code>~/keptn/repositories/front-end</code> and set the property <code>response-error-probability</code> to 20:</p>

<pre><code class="language-js">...
global.acmws['request-latency'] = 0;
global.acmws['request-latency-catalogue'] = 500; 
global.acmws['response-error-probability'] = 20;
...
</code></pre></li>

<li><p>Save changes to that file.</p></li>

<li><p>Commit your changes and push it to the remote repository.</p>

<pre><code class="language-console">$ git add .
$ git commit -m &quot;Changes in the server component&quot;
$ git push
</code></pre></li>

<li><p>You need the new version of the <code>front-end</code> service in the <em>staging</em> namespace, before you can start with a blue-green or canary deployment. Therefore, create a new release branch in the <code>front-end</code> repository using our Jenkins pipeline:</p>

<ol>
<li>Go to <strong>Jenkins</strong> and <strong>sockshop</strong>.</li>
<li>Click on <strong>create-release-branch</strong> pipeline and <strong>Schedule a build with parameters</strong>.</li>

<li><p>For the parameter <strong>SERVICE</strong>, enter the name of the service you want to create a release for. In this case: <strong>front-end</strong></p>

<p>The pipeline does the following:</p>

<ol>
<li>Reads the current version of the microservice.</li>
<li>Creates a release branch with the name release/<strong>version</strong>.</li>
<li>Increments the current version by 1.</li>
<li>Commits/Pushes the new version to the Git repository.</li>
</ol>

<p><img src="./assets/pipeline_release_branch.png" alt="pipeline_release_branch" /></p></li>
</ol></li>

<li><p>After the <strong>create-release-branch</strong> pipeline has finished, trigger the build pipeline for the <code>front-end</code> service and wait until the new artefacts is deployed to the <em>staging</em> namespace.</p>

<ul>
<li>Wait until the release/<strong>version</strong> build has finished.</li>
</ul></li>

<li><p>Deploy the new <code>front-end</code> to production</p>

<ol>
<li>Go to your <strong>Jenkins</strong> and click on <strong>k8s-deploy-production.update</strong>.</li>
<li>Click on <strong>master</strong> and <strong>Build with Parameters</strong>:

<ul>
<li>SERVICE: <code>front-end</code></li>
<li>VERSION: <code>v2</code></li>
</ul></li>
<li>Hit <strong>Build</strong> and wait until the pipeline shows: <em>Success</em>.</li>
</ol></li>
</ol>

<h2 id="step-4-simulate-a-bad-production-deployment">Step 4. Simulate a bad production deployment</h2>

<p>In this step, you will launch the above Ansible job that redirects the entire traffic to the new version of front-end in a canary release manner. Since the new front-end contains a failure, Dynatrace will open a problem and automatically invokes an auto-remediation action.</p>

<ol>
<li><p>Run the <code>kubectl get svc istio-ingressgateway -n istio-system</code> command to get the <em>EXTERNAL-IP</em> of your <em>Gateway</em>.</p>

<pre><code class="language-console">$ kubectl get svc istio-ingressgateway -n istio-system
NAME                   TYPE           CLUSTER-IP       EXTERNAL-IP     PORT(S)                                      AGE
istio-ingressgateway   LoadBalancer   172.21.109.129   1**.2**.1**.1**  80:31380/TCP,443:31390/TCP,31400:31400/TCP   17h
</code></pre></li>

<li><p>Simulation of real-user traffic</p>

<ol>
<li>In your Dynatrace tenant, go to <strong>Synthetic</strong> and click on <strong>Create a synthetic monitor</strong></li>
<li>Click on <strong>Create a browser monitor</strong></li>
<li>Type in the <em>EXTERNAL-IP</em> of your ingress gateway and give your monitor a name (e.g., Sockshop Monitor).</li>
<li>At <em>Frequency and locations</em> set Monitor my website every <strong>5</strong> minutes.</li>
<li>Select all locations and finally click on <strong>Monitor single URL</strong> and <strong>Create browser monitor</strong>.</li>
<li>Now, wait a couple of minutes for the synthetic traffic.</li>
</ol></li>

<li><p>Run job template in the Ansible Tower</p>

<ol>
<li>Go to Ansible Tower.</li>
<li>Start the job template <strong>canary</strong> to trigger a canary release of front-end <em>v2</em>.
<img src="./assets/canary_release_job.png" alt="canary_release_job" /></li>
</ol></li>

<li><p>(Optional) Adjust sensitivity of anomaly detection</p>

<ol>
<li>In your Dynatrace tenant, go to <strong>Transaction &amp; service</strong> and click on <strong>front-end.production</strong>.</li>
<li>Click on the <strong>&hellip;</strong> button in the top right corner and select <strong>Edit</strong>.</li>
<li>Go to <strong>Anomaly Detection</strong> and enable the switch for <em>Detect increases in failure rate</em>.

<ul>
<li>Select <code>using fixed thresholds</code></li>
<li>Alert if <code>2</code>% custom error rate threshold is exceeded during any 5-minute period.</li>
<li>Sensitivity: <code>High</code></li>
</ul></li>
<li>Go back to your service.</li>
</ol></li>

<li><p>Now, you need to wait until a problem appears in Dynatrace.</p></li>

<li><p>When Dynatrace opens a problem notification, it automatically invokes the remediation action as defined in the canary playbook. In fact, the remediation action refers to the <strong>remediation</strong> playbook, which then triggers the <strong>canary-reset</strong> playbook. Consequently, you see the executed playbooks when navigating to <em>Ansible Tower</em> and <em>Jobs</em>. Moreover, the failure rate of the front-end service must decrease since new traffic is routed to the previous version of front-end.
<img src="./assets/canary_reset.png" alt="canary_reset" /></p></li>
</ol>

<h2 id="step-5-cleanup">Step 5. Cleanup</h2>

<ol>
<li><p>Apply the configuration of the <strong>VirtualService</strong> to use v1 only.</p>

<pre><code class="language-console">$ cd ~/keptn/repositories/k8s-deploy-production/istio
$ kubectl apply -f virtual_service.yml
virtualservice.networking.istio.io/sockshop configured
</code></pre></li>

<li><p>Remove the failure from the front-end service.</p>

<ol>
<li><p>Open the file <code>server.js</code> in the master branch of the <code>~/keptn/repositories/front-end</code> and set the property <code>response-error-probability</code> to 0:</p>

<pre><code class="language-js">...
global.acmws['request-latency'] = 0;
global.acmws['request-latency-catalogue'] = 500; 
global.acmws['response-error-probability'] = 0;
...
</code></pre></li>

<li><p>Save the changes to that file.</p></li>

<li><p>Commit your changes and push it to the remote repository.</p>

<pre><code class="language-console">$ git add .
$ git commit -m &quot;Fixed issue in server component&quot;
$ git push
</code></pre></li>
</ol></li>
</ol>

<h2 id="understanding-what-happened">Understanding what happened</h2>

<p>In this use case, you intentionally introduced a failure into a service to demonstrate an early pipeline stop. Early enough to not deploy a faulty service version into production.</p>

<p>Assuming a bad deployment gets deployed to a production environment, then there must be a mechanism that triggers an auto-remediation action due to a problem notification. This action takes care of achieving a desired state. To experience this scenario, you created a failure in the front-end service, which were deployed to a production environment. As Dynatrace detected an increase of the failure rate, a problem notification automatically triggered a runbook in Ansible Tower that took care of rerouting traffic to the previous version.</p>




            
                
                
                    <h2 id="see-also"></h2>

                    <div class="see-also">
                        
                            <div class="entry">
                                <p class="link"><a href="/docs/usecases/runbook-automation-and-self-healing/">Runbook Automation and Self-healing</a></p>
                                <p class="desc">Gives an overview of how to leverage the power of runbook automation to build self-healing applications. Therefore, you will use Ansible Tower as the tool for executing and managing the runbooks.</p>
                            </div>
                        
                            <div class="entry">
                                <p class="link"><a href="/docs/usecases/performance-as-a-service/">Performance as a Service</a></p>
                                <p class="desc">Shows you how to setup a fully automated on-demand self-service model for performance testing.</p>
                            </div>
                        
                    </div>
                
            
        </main>

        
            <div class="pagenav">
                <div class="left">
                    
                        <p>
                            <a title="Gives an overview of how to leverage the power of runbook automation to build self-healing applications. Therefore, you will use Ansible Tower as the tool for executing and managing the runbooks." href="https://keptn.sh/docs/usecases/runbook-automation-and-self-healing/"><svg class="icon"><use xlink:href="/img/icons.svg#left-arrow"/></svg>Runbook Automation and Self-healing</a>
                        </p>
                    
                </div>
                <div class="right">
                    
                </div>
            </div>
        

        <div class="link-endnotes" aria-hidden="true">
            <h2></h2>
            <ol id="endnotes"></ol>
        </div>
    </div>

    
        <div class="toc-container">
            <nav class="toc">
                <div class="spacer"></div>
                <div id="toc" class="directory" role="directory">
                    





    







    
    

    
        
        <nav id="TableOfContents">
            <ul>
                
                
                    
                    
                    
                    

                    

                    <li><a href="#about-this-use-case">About this use case</a></li>

                    
                
                    
                    
                    
                    

                    

                    <li><a href="#step-1-simulate-an-early-pipeline-break">Step 1: Simulate an early pipeline break</a></li>

                    
                
                    
                    
                    
                    

                    

                    <li><a href="#step-2-setup-self-healing-action-for-production-deployment">Step 2: Setup self-healing action for production deployment</a></li>

                    
                
                    
                    
                    
                    

                    

                    <li><a href="#step-3-introduce-a-failure-into-front-end-and-deploy-to-production">Step 3: Introduce a failure into front-end and deploy to production</a></li>

                    
                
                    
                    
                    
                    

                    

                    <li><a href="#step-4-simulate-a-bad-production-deployment">Step 4. Simulate a bad production deployment</a></li>

                    
                
                    
                    
                    
                    

                    

                    <li><a href="#step-5-cleanup">Step 5. Cleanup</a></li>

                    
                
                    
                    
                    
                    

                    

                    <li><a href="#understanding-what-happened">Understanding what happened</a></li>

                    
                

                
                

                
                    
                        <li><a href="#see-also">See also</a></li>
                    
                
            </ul>
        </nav>
    


                </div>
            </nav>
        </div>
    
</div>



  </div>

  <div class="footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="footer-inner">
          <img alt="Keptn" src="https://keptn.sh/images/logo_white.svg" class="footer-logo"/><h3 class="footer-title">built with <span style="font-size: 1.8rem">&#x2665;</span> by Dynatrace</h3>
          <ul class="footer-menu">
            <li><a href="https://github.com/keptn/" target="_blank"><img alt="github" src="https://keptn.sh/social/github.svg" /></a></li>
            <li><a href="https://keptn.slack.com/" target="_blank"><img alt="slack" src="https://keptn.sh/social/slack.svg" /></a></li>
            <li><a href="https://twitter.com/keptnproject" target="_blank"><img alt="twitter" src="https://keptn.sh/social/twitter.svg" /></a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li><strong>Email: </strong><a href="mailto:keptn@dynatrace.com">
                keptn@dynatrace.com</a></li>
          </ul>
          <ul>
            <li class="zerostatic"><a href="https://keptn.sh">keptn.sh</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  
  
  
  
  
  
  

  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>

  
  <script type="text/javascript" src="/js/scripts.min.6d111557349b327a23f49ebbca651db173a6db206c8251e177fc4ffa955c2831.js"></script>
  <script type="text/javascript" src="/js/libs/doc/utils.min.e4f6edf1fb4538897beb4a38589df56162c9a3786e26dcac1eba43e5f136f104.js"></script>
  <script type="text/javascript" src="/js/libs/doc/misc.min.ed496662b7e3100b5a0fb8aff7eb00424b75ab3ffc1e06528004efb2529153f5.js"></script>
  <script type="text/javascript" src="/js/libs/doc/prism.min.ccc0e2507ebaf84f84a022e4628fd98c50c9c636e3c447653b6c813f04258344.js"></script>
  <script type="text/javascript" src="/js/libs/doc/lightbox/js/lightbox-plus-jquery.min.min.caa0181254e65ca8b51c5db7115641bd56796eeb7236589c6d6e1785cfb37e9d.js"></script>
  

  

  
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-133584243-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
  
    gtag('config', 'UA-133584243-1');
  </script>



</body>

</html>