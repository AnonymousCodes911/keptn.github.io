<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Runbook Automation and Self-healing - keptn</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google-site-verification" content="wDzKASaTgmwGTtV-z_O-NU_6e1wOgA7spKT96o9r8XE" />
  
  <link rel="icon" href="https://keptn.sh/favicon.png">

  
  
  <link rel="stylesheet" href="/css/style.min.821919e21a897e2d44560dc93ae95d622a07179547d0969419b46936cfcf90b5.css">
  <link rel="stylesheet" href="/js/libs/doc/lightbox/css/lightbox.min.min.1bbb47ec548f1c47e276ce27971cdc27f8c803ee4bb96f064c72c7448f7c0f12.css">
  
  <script>
    var branchName = "";
    var docTitle = "Runbook Automation and Self-healing";
    var iconFile = "https:\/\/keptn.sh\//img/icons.svg";
    var buttonCopy = '';
    var buttonPrint = '';
    var buttonDownload = '';
  </script>
</head>

<body class='page '>
  
<div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-docs">
      <a href="/docs/">
        
        <span>Docs</span>
      </a>
    </li>
    
  </ul>
</div>

  <div class="wrapper">

    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="https://keptn.sh/"><img alt="Keptn Homepage" src="https://keptn.sh/images/logo.svg" /></a>
    </div>
    <div class="logo-mobile">
      <a href="https://keptn.sh/"><img alt="Keptn Homepage" src="https://keptn.sh/images/logo-mobile.svg" /></a>
    </div>
    
<div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-docs">
      <a href="/docs/">
        
        <span>Docs</span>
      </a>
    </li>
    
  </ul>
</div>

    
<button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" role="presentation" aria-label="mobile menu trigger">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>

  </div>
</div>
    <a href="https://github.com/keptn/" class="github-corner" aria-label="Keptn on GitHub">
  <svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true">
    <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z" fill="#151513"></path>
    <path class="octo-arm" d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="#ffffff" style="transform-origin: 130px 106px;"></path>
    <path class="octo-body" d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="#ffffff"></path>
  </svg>
</a>
    <div class="container">
      




    <div class="primary">


    <div id="sidebar-container" class="sidebar-container sidebar-offcanvas">
        
        
            <nav class="sidebar">
    <div class="spacer"></div>
    <div class="directory" role="tablist">
        

        
        

        
            
        
            
        
            

                <div class="card">
                    <div class="card-header" role="tab" id="header2">
                        <a data-toggle="collapse" href="#collapse2" title="How to deploy keptn in Kubernetes." role="button" aria-controls="collapse2">
                            <div><svg class="icon"><use xlink:href="/img/icons.svg#setup"/></svg>Setup</div>
                        </a>
                    </div>

                    <div id="collapse2" class="collapse" role="tabpanel" aria-labelledby="header2">
                        <div class="card-body">
                            




<ul class="tree">
    
        
    
        
            
                <li class="sublist">
                    

                    <label class='tree-toggle'><i class="chevron show"><svg class="icon"><use xlink:href="/img/icons.svg#right-chevron"/></svg></i><i class="chevron"><svg class="icon"><use xlink:href="/img/icons.svg#down-chevron"/></svg></i><a  title="Instructions for installing keptn on Kubernetes." href="https://keptn.sh/docs/setup/kubernetes/">Kubernetes</a>
                    </label>

                    




<ul class="tree collapse">
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            
                <li>
                    
                        <a title="Demonstrates how to install keptn in a Kubernetes cluster on Google Container Engine (GKE)." href="https://keptn.sh/docs/setup/kubernetes/install-keptn-v.0.1/">Install keptn v.0.1 on GKE</a>
                    
                </li>
             
        
    
</ul>

                </li>
            
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
</ul>

                        </div>
                    </div>
                </div>
            
        
            
        
            
        
            
        
            
        
            

                <div class="card">
                    <div class="card-header" role="tab" id="header7">
                        <a data-toggle="collapse" href="#collapse7" title="How to do specific targeted activities with keptn." role="button" aria-controls="collapse7">
                            <div><svg class="icon"><use xlink:href="/img/icons.svg#tasks"/></svg>Use Cases</div>
                        </a>
                    </div>

                    <div id="collapse7" class="collapse show" role="tabpanel" aria-labelledby="header7">
                        <div class="card-body">
                            




<ul class="tree">
    
        
    
        
    
        
    
        
            
                <li>
                    
                        <a title="Shows you how to setup a fully automated on-demand self-service model for performance testing." href="https://keptn.sh/docs/usecases/performance-as-a-service/">Performance as a Service</a>
                    
                </li>
             
        
    
        
            
                <li>
                    
                        <a title="Gives an overview of production deployments, deployment strategies, and depicts those using Istio on Kubernetes to canary-deploy a new front-end version." href="https://keptn.sh/docs/usecases/production-deployments/">Production Deployments</a>
                    
                </li>
             
        
    
        
            
                <li>
                    
                        <span class="current" title="Gives an overview of how to leverage the power of runbook automation to build self-healing applications. Therefore, you will use Ansible Tower as the tool for executing and managing the runbooks.">Runbook Automation and Self-healing</span>
                    
                </li>
             
        
    
        
            
                <li>
                    
                        <a title="Shows you how to implement a delivery pipeline that prevents bad code changes from impacting your end users." href="https://keptn.sh/docs/usecases/unbreakable-delivery-pipeline/">Unbreakable Delivery Pipeline</a>
                    
                </li>
             
        
    
        
    
        
    
</ul>

                        </div>
                    </div>
                </div>
            
        
            
        

        
            
        
    </div>
</nav>

        
    </div>

    <div class="article-container">
        
            <label class="sidebar-toggler" id="sidebar-toggler" title=''>
                <svg class="icon"><use xlink:href="/img/icons.svg#pull"/></svg>
            </label>
        

        <div class="pagenav">
            <p>


    
        
        
        
    

    
        
        
        
    

    
        
        
        
    

    
        
        
        
    




    
    
    

    
        <a href="https://keptn.sh/">Home</a>
        <span>/</span>
    

    
    
    

    
        <a href="https://keptn.sh/docs/">Docs</a>
        <span>/</span>
    

    
    
    

    
        <a href="https://keptn.sh/docs/usecases/">Use Cases</a>
        <span>/</span>
    

    
    
    

    
        Runbook Automation and Self-healing
    

</p>
        </div>

        <main aria-labelledby="title">
            <h1 id="title">Runbook Automation and Self-healing</h1>

            

            
                <p class="byline"><span title="%!(EXTRA int=1622)"><svg class="icon"><use xlink:href="/img/icons.svg#clock"/></svg><span>&nbsp;</span>%!(EXTRA int=8)</span></p>
            

            
                <nav class="toc-inlined">
                    <hr/>
                    <div class="directory" role="directory">
                        





    







    
    

    
        
        <nav id="InlinedTableOfContents">
            <ul>
                
                
                    
                    
                    
                    

                    

                    <li><a href="#about-this-use-case">About this use case</a></li>

                    
                
                    
                    
                    
                    

                    

                    <li><a href="#step-1-check-prerequisites">Step 1: Check prerequisites</a></li>

                    
                
                    
                    
                    
                    

                    

                    <li><a href="#step-2-1-verify-installation-of-ansible-tower">Step 2.1: Verify installation of Ansible Tower</a></li>

                    
                
                    
                    
                    
                    

                    

                    <li><a href="#step-2-2-verify-predefined-templates-projects-and-inventories">Step 2.2 Verify predefined Templates, Projects, and Inventories</a></li>

                    
                
                    
                    
                    
                    

                    

                    <li><a href="#step-3-integration-of-ansible-tower-runbook-in-dynatrace">Step 3: Integration of Ansible Tower runbook in Dynatrace</a></li>

                    
                
                    
                    
                    
                    

                    

                    <li><a href="#step-4-apply-anomaly-detection-rules">Step 4: Apply anomaly detection rules</a></li>

                    
                
                    
                    
                    
                    

                    

                    <li><a href="#step-5-run-a-promotional-campaign">Step 5: Run a promotional campaign</a></li>

                    
                
                    
                    
                    
                    

                    

                    <li><a href="#understanding-what-happened">Understanding what happened</a></li>

                    
                

                
                

                
                    
                        <li><a href="#see-also">See also</a></li>
                    
                
            </ul>
        </nav>
    


                    </div>
                    <hr/>
                </nav>
            



<p>This use case gives an overview of how to leverage the power of runbook automation to build self-healing applications. Therefore, you will use Ansible Tower as the tool for executing and managing the runbooks.</p>

<h2 id="about-this-use-case">About this use case</h2>

<p>In this use case, we are going to use the <a href="https://github.com/dynatrace-sockshop">Dynatrace Sockshop</a> as our demo application. Assume that we want to start a marketing campaign for our SockShop, which will add promotional gifts (e.g., Halloween socks, Christmas socks, &hellip;) to a given percentage of interactions with the shopping cart. However, if something goes wrong with the campaign, we want to have mechanisms in place, to be able to stop the campaign automatically.</p>

<p>In our scenario, we will use Ansible Tower as the tool that is managing the promotional campaigns. We will have a playbook that allows us to configure and start a campaign, e.g., adding gifts to 30 % of the interactions with the shopping cart, i.e., about <sup>1</sup>&frasl;<sub>3</sub> of the items placed in the shopping card will be awarded an additional gift. In addition, we will have a playbook that stops the campaign if something goes wrong.
Therefore, in this use case we will experience troubles with the promotional campaign. We will setup means that automatically execute the playbook that can stop the campaign based on the information we get from our monitoring tool Dynatrace.</p>


<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="//www.youtube.com/embed/iguxwIQdug8" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>


<h2 id="step-1-check-prerequisites">Step 1: Check prerequisites</h2>

<ol>
<li><p>A personal license for Ansible Tower is needed. In case you don&rsquo;t have a license yet, you can get a free license here: <a href="https://www.ansible.com/license">https://www.ansible.com/license</a></p>

<p>The personal edition with limited features is sufficient for this use case.</p>

<p><img src="./assets/ansible-license-free.png" alt="free license" /></p></li>
</ol>

<h2 id="step-2-1-verify-installation-of-ansible-tower">Step 2.1: Verify installation of Ansible Tower</h2>

<p>During the setup of the cluster, Ansible Tower has already been installed and preconfigured.</p>

<ol>
<li><p>Login to your Ansible Tower instance.</p>

<p>Receive the public IP from your Ansible Tower:</p>

<pre><code class="language-console">$ kubectl get services -n tower
NAME            TYPE           CLUSTER-IP     EXTERNAL-IP     PORT(S)         AGE
ansible-tower   LoadBalancer   xx.xx.xxx.xx   xx.xxx.xxx.xx   443:30528/TCP   1d
</code></pre>

<p>Copy the <code>EXTERNAL-IP</code> into a browser and navigate to <a href="https://external-ip">https://external-ip</a></p></li>

<li><p>Submit the Ansible Tower license when prompted.
<img src="./assets/ansible-license.png" alt="ansible license prompt" /></p></li>

<li><p>Your login is:</p>

<ul>
<li>Username: <code>admin</code></li>
<li>Password: <code>dynatrace</code></li>
</ul>

<p>You should see the initial dashboard after your first login.
<img src="./assets/tower-initial-dashboard.png" alt="Ansible Tower dashboard" /></p></li>
</ol>

<h2 id="step-2-2-verify-predefined-templates-projects-and-inventories">Step 2.2 Verify predefined Templates, Projects, and Inventories</h2>

<p>When running the install scripts, Ansible Tower is already preconfigured for this use case. The needed templates, inventories, and projects are already created and set up but should be verified.</p>

<ol>
<li><p><strong>Credentials</strong></p>

<p>Click on <strong>Credentials</strong> and verify that the <code>git-token</code> passed via the <code>creds.json</code> file has been added to your Ansible Tower instance.</p></li>

<li><p><strong>Inventories</strong></p>

<p>Click on <strong>Inventories</strong> and verify that an inventory with some variables has already been added for you.</p></li>

<li><p><strong>Projects</strong></p>

<p>Click on <strong>Projects</strong> and verify that a project with name <strong>self-healing</strong> has been added.</p></li>

<li><p><strong>Templates</strong></p>

<p>Click on <strong>Templates</strong> and verify that several job templates have been added.</p>

<ul>
<li>canary</li>
<li>canary-reset</li>
<li>remediation</li>
<li>start-campaign</li>
<li>stop-campaign</li>
</ul>

<p>Please go ahead an open the <em>remediation</em> playbook. Copy the URL from your browser to your clipboard, we will need it in a second.
<img src="./assets/ansible-remediation-template.png" alt="remediation-template" /></p></li>
</ol>

<h2 id="step-3-integration-of-ansible-tower-runbook-in-dynatrace">Step 3: Integration of Ansible Tower runbook in Dynatrace</h2>

<p>This step integrates the defined <em>remediation runbook</em> in Dynatrace in a way that it will be called each time Dynatrace detects a problem. Please note that in an enterprise scenario, you might want to define <em>Alerting profiles</em> to be able to control problem notifications in a more fine-grained way when to call a remediation runbook.</p>

<ol>
<li><p>Setup a problem notification in Dynatrace</p>

<ul>
<li><p>Navigate to <strong>Settings</strong>, <strong>Integration</strong>, <strong>Problem notification</strong>, <strong>Set up notifications</strong>, and <strong>Ansible Tower</strong></p>

<p><img src="./assets/ansible-integration.png" alt="integration" /></p></li>
</ul></li>

<li><p>Enter your Ansible Tower job template URL and Ansible Tower credentials.</p>

<ul>
<li>Name: e.g., <code>remediation</code></li>
<li>Ansible Tower job template URL: copy &amp; paste the Ansible Tower job URL from your Ansible Tower remediation job template, e.g., <code>https://XX.XXX.XX.XXX/#/templates/job_template/18</code> (you should have this copied to your clipboard already in the <a href="#copy-to-clipboard">previous step</a> )</li>
<li>Username: <code>admin</code> (your Ansible Tower username)</li>
<li>Password: <code>dynatrace</code> (your Ansible Tower password)</li>
<li>Click <strong>Send test notification</strong> &gt; a green banner should appear.</li>

<li><p><strong>Save</strong> the integration</p>

<p><img src="./assets/ansible-integration-successful.png" alt="integration successful" /></p></li>
</ul></li>

<li><p><em>Optional:</em> Navigate back to your Ansible Tower instance and check what happenend when setting up the integration.</p>

<ul>
<li>Navigate to <strong>Jobs</strong> and click on your <em>X - remediation</em> job</li>
<li>You can see all tasks from the playbook that have been triggered by the integration.</li>
</ul></li>
</ol>

<h2 id="step-4-apply-anomaly-detection-rules">Step 4: Apply anomaly detection rules</h2>

<p>Both problem and anomaly detection in Dynatrace leverage AI technology. This means that the AI learns how each and every microservice behaves and baselines them. Therefore, in a demo scenario like we have right now, we have to override the AI engine with user-defined values to allow the creation of problems due to an artificial increase of a failure rate. (Please note if we would have the application running and simulate end-user traffic for a couple of days there would be no need for this step.)</p>

<p>In your Dynatrace tenant, navigate to &ldquo;Transaction &amp; services&rdquo; and filter by: <em>app:carts</em> and <em>environment:production</em> (This assumes that you have done the previous use-cases of keptn)</p>

<p><img src="./assets/dynatrace-services.png" alt="services" /></p>

<p>Click on the <strong>ItemsController</strong> and then on the three dots ( <kbd>&hellip;</kbd> ) next to the service name. Click on <em>Edit</em>.
<img src="./assets/dynatrace-service-edit.png" alt="service-edit" /></p>

<p>On the next screen, edit the anomaly detection settings as seen in the following screenshot.
- <strong>Globaly anomaly detection</strong> has to be <strong>turned off</strong>
- Detect increases in <strong>failure rate</strong> using <strong>fixed thresholds</strong>
- Alert if <strong>10 %</strong> custom failure rate threshold is exceed during any 5-minute period.
- Sensitivity: <strong>High</strong></p>

<p><img src="./assets/anomaly-detection.png" alt="anomaly detection" /></p>

<h2 id="step-5-run-a-promotional-campaign">Step 5: Run a promotional campaign</h2>

<p>This step runs a promotional campaign in our production environment by applying a change to our configuration of the <code>carts</code> service. This service is prepared to allow to add a promotional gift (e.g., Halloween Socks, Christmas Socks, Easter Socks, &hellip;) to a given percentage of user interactions in the <code>carts</code> service.</p>

<p>Therefore, the endpoint <code>carts/1/items/promotional/</code> can take a number between 0 and 100 as an input, which corresponds to the percentages of user interactions that will receive the promotional gift, i.e., <code>carts/1/items/promotional/5</code> will enable it for 5 %, while <code>carts/1/items/promotional/100</code> will enable it for 100 % of user interactions.</p>

<p>The promotional itself is controlled via Ansible Tower. That means that starting, and eventually stopping the campaign is done by triggering Ansible Tower job templates that in turn start Ansible playbooks.</p>

<ol>
<li><p>First, we want to generate load for the carts service</p>

<ul>
<li>Receive the IP of the carts service by executing the <code>kubectl get svc -n production</code> command:</li>
</ul>

<pre><code class="language-console">  $ kubectl get svc carts -n production
  NAME    TYPE           CLUSTER-IP      EXTERNAL-IP       PORT(S)        AGE
  carts   LoadBalancer   xx.xx.xxx.xxx   xxx.xxx.xxx.xxx   80:31399/TCP   1d
</code></pre>

<ul>
<li>From inside your <code>keptn</code> directory, navigate to the <code>usecases/runbook-automation-and-self-healing/scripts</code> directory and start the <a href="../scripts/">add-to-cart</a> script using the IP of your carts service.</li>
</ul>

<pre><code class="language-console">  $ cd usecases/runbook-automation-and-self-healing/scripts
  $ ./add-to-cart.sh http://XXX.XXX.XXX.XXX/carts/1/items

  Press [CTRL+C] to stop..

  adding item to cart...
  {&quot;id&quot;:&quot;3395a43e-2d88-40de-b95f-e00e1502085b&quot;,&quot;itemId&quot;:&quot;03fef6ac-1896-4ce8-bd69-b798f85c6e0b&quot;,&quot;quantity&quot;:2187,&quot;unitPrice&quot;:0.0}
  adding item to cart...
  {&quot;id&quot;:&quot;3395a43e-2d88-40de-b95f-e00e1502085b&quot;,&quot;itemId&quot;:&quot;03fef6ac-1896-4ce8-bd69-b798f85c6e0b&quot;,&quot;quantity&quot;:2188,&quot;unitPrice&quot;:0.0}
  adding item to cart...
  {&quot;id&quot;:&quot;3395a43e-2d88-40de-b95f-e00e1502085b&quot;,&quot;itemId&quot;:&quot;03fef6ac-1896-4ce8-bd69-b798f85c6e0b&quot;,&quot;quantity&quot;:2189,&quot;unitPrice&quot;:0.0}
  ...
</code></pre></li>

<li><p>Run the promotional campain</p>

<ul>
<li>Navigate to <strong>Templates</strong> in your Ansible Tower</li>
<li>Click on the &ldquo;rocket&rdquo; icon (🚀) next to your <em>start-campaign</em> job template
<img src="./assets/ansible-template-run.png" alt="run template" /></li>
<li>Adjust the values accordingly for you promotional campaign:

<ul>
<li>Set the value for <code>promotion_rate: '30'</code> to allow for 30 % of the user interactions to receive the promotional gift</li>
<li>Do not change the <code>remediation_action</code>, this is already configured for you and it is set to the <code>stop-campaign</code> job template URL.</li>
</ul></li>
<li>Click <strong>Next</strong>, then <strong>Launch</strong></li>
</ul></li>

<li><p>To verify the update in the <code>carts</code> service in Dynatrace, navigate to the <code>carts</code> service in your Dynatrace tenant and see the configuration change that has been applied and attached to the <code>carts</code> service in the production environment.
<img src="./assets/service-custom-configuration-event.png" alt="custom configuration event" /></p>

<p>Please also note that a remediation action has been attached to this configuration change. This means, if Dynatrace detects a problem with this service that is related to this configuratio change, this remediation action could be called to remediate the problem.</p></li>

<li><p>Looking at the loadgeneration output in your console, you will notice that about <sup>1</sup>&frasl;<sub>3</sub> of the requests will produce an error.</p>

<pre><code class="language-console">...
{&quot;id&quot;:&quot;3395a43e-2d88-40de-b95f-e00e1502085b&quot;,&quot;itemId&quot;:&quot;03fef6ac-1896-4ce8-bd69-b798f85c6e0b&quot;,&quot;quantity&quot;:13916,&quot;unitPrice&quot;:0.0}
adding item to cart...
{&quot;id&quot;:&quot;3395a43e-2d88-40de-b95f-e00e1502085b&quot;,&quot;itemId&quot;:&quot;03fef6ac-1896-4ce8-bd69-b798f85c6e0b&quot;,&quot;quantity&quot;:13917,&quot;unitPrice&quot;:0.0}
adding item to cart...
{&quot;timestamp&quot;:1549290255564,&quot;status&quot;:500,&quot;error&quot;:&quot;Internal Server Error&quot;,&quot;exception&quot;:&quot;java.lang.Exception&quot;,&quot;message&quot;:&quot;promotion campaign not yet implemented&quot;,&quot;path&quot;:&quot;/carts/1/items&quot;}
...
</code></pre></li>

<li><p>After a couple of minutes, Dynatrace will open a problem ticket for the increase of the failure rate. Since we have setup the problem notification with Ansible Tower, the according <em>remediation</em> playbook will be executed once Dynatrace sends out the notification.</p>

<p>The <strong>open problem ticket</strong> in Dynatrace gives us detailed information on the problem:</p>

<ul>
<li>we see how many users, service calls, and services are impacted (1 service, ItemsController)</li>
<li>we see why the problem was created (increase of the failure rate)</li>
<li>Dynatrace detected the root cause of the problem

<ul>
<li>failure rate increase due to</li>
<li>configuration change</li>
</ul></li>

<li><p>we already see two comments on the problem</p>

<ul>
<li>one comment that the remediation playbook has started</li>
<li>one comment that the remediation playbook has already finished executing</li>
</ul>

<p><img src="./assets/dynatrace-problem.png" alt="problem details" /></p></li>
</ul></li>

<li><p>To verify executed playbooks in Ansible Tower, navigate to <strong>Jobs</strong> and verify that Ansible Tower has executed two jobs.</p>

<ul>
<li>The first job <code>X - remediation</code> was called since Dynatrace sent out the problem notification to Ansible Tower.</li>

<li><p>This job was then executing the remediation tasks which include the execution of the remediation action that is defined in the custom configuration event of the impacted entities (the <code>carts</code> service). Therefore, you will also see a job called <code>X - stop-campaign</code> that was executed.</p>

<p><img src="./assets/ansible-remediation-execution.png" alt="remediation job execution" /></p></li>
</ul></li>

<li><p>The remediation playbook set back the promotion rate to 0 %, which is also send as <em>Configuration changed event</em> to Dynatrace:
<img src="./assets/service-custom-configuration-event-remediation.png" alt="custom configuration event" /></p></li>

<li><p>Problem is remediated thanks to automating runbook execution by Dynatrace!</p></li>
</ol>

<h2 id="understanding-what-happened">Understanding what happened</h2>

<p>In this use case, we have seen how we can leverage runbook automation in response to issues that are detected in our environment. In the use case we have seen here, the developer has prepared a runbook for starting the campaign and one for stopping the campaign. In addition, a remediation runbook was provided which was able to receive problem notifications from Dynatrace, parse the problem, and execute the remediation action (i.e., stopping the campaign) that was attached to the root cause of the problem.</p>




            
                
                
                    <h2 id="see-also"></h2>

                    <div class="see-also">
                        
                            <div class="entry">
                                <p class="link"><a href="/docs/usecases/unbreakable-delivery-pipeline/">Unbreakable Delivery Pipeline</a></p>
                                <p class="desc">Shows you how to implement a delivery pipeline that prevents bad code changes from impacting your end users.</p>
                            </div>
                        
                    </div>
                
            
        </main>

        
            <div class="pagenav">
                <div class="left">
                    
                        <p>
                            <a title="Gives an overview of production deployments, deployment strategies, and depicts those using Istio on Kubernetes to canary-deploy a new front-end version." href="https://keptn.sh/docs/usecases/production-deployments/"><svg class="icon"><use xlink:href="/img/icons.svg#left-arrow"/></svg>Production Deployments</a>
                        </p>
                    
                </div>
                <div class="right">
                    
                        <p>
                            <a title="Shows you how to implement a delivery pipeline that prevents bad code changes from impacting your end users." href="https://keptn.sh/docs/usecases/unbreakable-delivery-pipeline/">Unbreakable Delivery Pipeline<svg class="icon"><use xlink:href="/img/icons.svg#right-arrow"/></svg></a>
                        </p>
                    
                </div>
            </div>
        

        <div class="link-endnotes" aria-hidden="true">
            <h2></h2>
            <ol id="endnotes"></ol>
        </div>
    </div>

    
        <div class="toc-container">
            <nav class="toc">
                <div class="spacer"></div>
                <div id="toc" class="directory" role="directory">
                    





    







    
    

    
        
        <nav id="TableOfContents">
            <ul>
                
                
                    
                    
                    
                    

                    

                    <li><a href="#about-this-use-case">About this use case</a></li>

                    
                
                    
                    
                    
                    

                    

                    <li><a href="#step-1-check-prerequisites">Step 1: Check prerequisites</a></li>

                    
                
                    
                    
                    
                    

                    

                    <li><a href="#step-2-1-verify-installation-of-ansible-tower">Step 2.1: Verify installation of Ansible Tower</a></li>

                    
                
                    
                    
                    
                    

                    

                    <li><a href="#step-2-2-verify-predefined-templates-projects-and-inventories">Step 2.2 Verify predefined Templates, Projects, and Inventories</a></li>

                    
                
                    
                    
                    
                    

                    

                    <li><a href="#step-3-integration-of-ansible-tower-runbook-in-dynatrace">Step 3: Integration of Ansible Tower runbook in Dynatrace</a></li>

                    
                
                    
                    
                    
                    

                    

                    <li><a href="#step-4-apply-anomaly-detection-rules">Step 4: Apply anomaly detection rules</a></li>

                    
                
                    
                    
                    
                    

                    

                    <li><a href="#step-5-run-a-promotional-campaign">Step 5: Run a promotional campaign</a></li>

                    
                
                    
                    
                    
                    

                    

                    <li><a href="#understanding-what-happened">Understanding what happened</a></li>

                    
                

                
                

                
                    
                        <li><a href="#see-also">See also</a></li>
                    
                
            </ul>
        </nav>
    


                </div>
            </nav>
        </div>
    
</div>



  </div>

  <div class="footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="footer-inner">
          <img alt="Keptn" src="https://keptn.sh/images/logo_white.svg" class="footer-logo"/><h3 class="footer-title">built with <span style="font-size: 1.8rem">&#x2665;</span> by Dynatrace</h3>
          <ul class="footer-menu">
            <li><a href="https://github.com/keptn/" target="_blank"><img alt="github" src="https://keptn.sh/social/github.svg" /></a></li>
            <li><a href="https://keptn.slack.com/" target="_blank"><img alt="slack" src="https://keptn.sh/social/slack.svg" /></a></li>
            <li><a href="https://twitter.com/keptnproject" target="_blank"><img alt="twitter" src="https://keptn.sh/social/twitter.svg" /></a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li><strong>Email: </strong><a href="mailto:keptn@dynatrace.com">
                keptn@dynatrace.com</a></li>
          </ul>
          <ul>
            <li class="zerostatic"><a href="https://keptn.sh">keptn.sh</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  
  
  
  
  
  
  

  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>

  
  <script type="text/javascript" src="/js/scripts.min.6d111557349b327a23f49ebbca651db173a6db206c8251e177fc4ffa955c2831.js"></script>
  <script type="text/javascript" src="/js/libs/doc/utils.min.e4f6edf1fb4538897beb4a38589df56162c9a3786e26dcac1eba43e5f136f104.js"></script>
  <script type="text/javascript" src="/js/libs/doc/misc.min.ed496662b7e3100b5a0fb8aff7eb00424b75ab3ffc1e06528004efb2529153f5.js"></script>
  <script type="text/javascript" src="/js/libs/doc/prism.min.ccc0e2507ebaf84f84a022e4628fd98c50c9c636e3c447653b6c813f04258344.js"></script>
  <script type="text/javascript" src="/js/libs/doc/lightbox/js/lightbox-plus-jquery.min.min.caa0181254e65ca8b51c5db7115641bd56796eeb7236589c6d6e1785cfb37e9d.js"></script>
  

  

  
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-133584243-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
  
    gtag('config', 'UA-133584243-1');
  </script>



</body>

</html>