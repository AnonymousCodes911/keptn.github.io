<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Production Deployments - keptn</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google-site-verification" content="wDzKASaTgmwGTtV-z_O-NU_6e1wOgA7spKT96o9r8XE" />
  
  <link rel="icon" href="https://keptn.sh/favicon.png">

  
  
  <link rel="stylesheet" href="/css/style.min.6c01e0e2d65af4123d4056c6552d1ab1e514b7cec20381731da9c58b1d5a036c.css">
  <link rel="stylesheet" href="/js/libs/doc/lightbox/css/lightbox.min.min.1bbb47ec548f1c47e276ce27971cdc27f8c803ee4bb96f064c72c7448f7c0f12.css">
  
  <script type="text/javascript">
    (function () {
      (function () {
        function a() { if (!b.dialogArguments) return navigator.cookieEnabled; document.cookie = "__dTCookie=1"; var a = -1 !== document.cookie.indexOf("__dTCookie"); document.cookie = "__dTCookie=1; expires=Thu, 01-Jan-1970 00:00:01 GMT"; return a } if (window.dT_) window.console && window.console.log("Duplicate agent injection detected, turning off redundant initConfig."); else {
          var b = "undefined" !== typeof window ? window : self; a() && (window.dT_ || (window.dT_ = {
            cfg: "app=878036b6096f88c7|cors=1|featureHash=A2SVfqr|srsr=25000|reportUrl=https://bf44680svb.bf-sprint.dynatracelabs.com/bf|rdnt=1|uxrgce=1|bp=2|srms=1,1,,,|uxrgcm=100,25,300,3;100,25,300,3|dpvc=1|lastModification=1550764375989|dtVersion=10163190220134628|tp=500,50,0,1|featureHash=A2SVfqr|agentUri=https://js-cdn.dynatracelabs.com/jstag/145e049b9b1/ruxitagent_A2SVfqr_10163190220134628.js|auto=|domain=|rid=RID_|rpid=|app=878036b6096f88c7",
            iCE: a
          }))
        }
      })();
    }).call(this);

    (function () {
      (function () {
        function Gb() { return ka ? new ka : la ? new la("MSXML2.XMLHTTP.3.0") : e.XMLHttpRequest ? new e.XMLHttpRequest : new e.ActiveXObject("MSXML2.XMLHTTP.3.0") } function Hb() { la = ka = void 0 } function r() { var a = 0; try { a = e.performance.timing.navigationStart + Math.floor(e.performance.now()) } catch (b) { } return 0 >= a || isNaN(a) || !isFinite(a) ? (new Date).getTime() : a } function aa(a, b) {
          function c() { delete ba[f]; a.apply(this, arguments) } for (var d = [], ma = 2; ma < arguments.length; ma++)d[ma - 2] = arguments[ma]; var f; "apply" in na ? f = na.apply(e,
            [c, b].concat(d)) : f = na(c, b); ba[f] = !0; return f
        } function Va(a) { delete ba[a]; "apply" in O ? O.call(e, a) : O(a) } function h(a) { for (var b = [], c = 1; c < arguments.length; c++)b[c - 1] = arguments[c]; a.push.apply(a, b) } function Wa(a) { h(wa, a) } function Ib() { return wa } function Jb(a, b) { return Xa(a, b) } function Kb(a, b) { a = new Lb([a], { type: b }); return Mb(a) } function Nb(a, b) { return Ya ? new Ya(a, b) : void 0 } function Ob(a) { "function" === typeof a && h(Za, a) } function Pb() { return Za } function Qb() { return xa } function $a(a) {
          return function () {
            for (var b =
              [], c = 0; c < arguments.length; c++)b[c] = arguments[c]; if ("number" !== typeof b[0] || !ba[b[0]]) try { return a.apply(this, b) } catch (d) { return a(b[0]) }
          }
        } function Rb() { ca && (e.clearTimeout = O, e.clearInterval = ya, ca = !1) } function P(a, b) { return isNaN(a) || isNaN(b) ? 0 : Math.floor(Math.random() * (b - a + 1)) + a } function Q(a, b) { return parseInt(a, b || 10) } function k(a, b, c) { void 0 === c && (c = 0); var d = -1; b && a && a.indexOf && (d = a.indexOf(b, c)); return d } function ab(a) { return document.getElementsByTagName(a) } function bb(a) {
          var b = a.length; if ("number" ===
            typeof b) a = b; else { for (var b = 0, c = 2048; a[c - 1];)b = c, c += c; for (var d = 7; 1 < c - b;)d = (c + b) / 2, a[d - 1] ? b = d : c = d; a = a[d] ? c : b } return a
        } function Sb(a) { a = encodeURIComponent(a); var b = []; if (a) for (var c = 0; c < a.length; c++) { var d = a.charAt(c); h(b, Tb[d] || d) } return b.join("") } function w(a) { if (!a) return ""; var b = e.crypto || e.msCrypto; if (b) { var c = new Int8Array(a); b.getRandomValues(c) } else for (c = [], b = 0; b < a; b++)c.push(P(0, 32)); a = []; for (b = 0; b < c.length; b++) { var d = Math.abs(c[b] % 32); a.push(String.fromCharCode(d + (9 >= d ? 48 : 55))) } return a.join("") }
        function cb() { return !(!e.console || !e.console.log) } function Ub() { try { Vb.apply(e.parent, arguments) } catch (a) { } } function Wb() { try { Xb.apply(e.top, arguments) } catch (a) { } } function Yb(a) { var b = Array.prototype.slice.call(arguments, 1); try { Zb.apply(a, b) } catch (c) { } } function $b(a) { var b = Array.prototype.slice.call(arguments, 1); try { ac.apply(a, b) } catch (c) { } } function x() { return e.dT_ } function bc() { return D } function cc() { return db } function dc() { return eb } function ec() { return oa } function fb() { return "dtAdk" } function fc() { return R }
        function gb(a) { -1 < e.dT_.io(a, "^") && (a = a.split("^^").join("^"), a = a.split("^dq").join('"'), a = a.split("^rb").join(">"), a = a.split("^lb").join("<"), a = a.split("^p").join("|"), a = a.split("^e").join("="), a = a.split("^s").join(";"), a = a.split("^c").join(","), a = a.split("^bs").join("\\")); return a } function gc() { return S } function hc(a) { S = a } function hb(a) { var b = e.dT_, c = b.scv("rid"), b = b.scv("rpid"); c && (a.rid = c); b && (a.rpid = b) } function ib(a) { if (a.xb) { a = gb(a.xb); try { S = new RegExp(a) } catch (b) { } } } function jb(a) {
          var b = {};
          a = a.split("|"); for (var c = 0; c < a.length; c++) { var d = a[c].split("="); 2 === d.length && (b[d[0]] = decodeURIComponent(d[1].replace(/\+/g, " "))) } return b
        } function za() { var a = n("csu"); return (a.indexOf("dbg") === a.length - 3 ? a.substr(0, a.length - 3) : a) + "_" + n("app") + "_Store" } function pa(a, b, c) {
          b = b || {}; a = a.split("|"); for (var d = 0; d < a.length; d++) { var e = a[d], f = k(a[d], "="); -1 === f ? b[e] = "1" : (e = a[d].substring(0, f), b[e] = a[d].substring(f + 1, a[d].length)) } !c && (c = b, a = c.spc) && (d = document.createElement("textarea"), d.innerHTML = a, c.spc =
            d.value); return b
        } function T(a) { return a in f ? f[a] : qa[a] } function m(a) { a = T(a); return "false" === a || "0" === a ? !1 : !!a } function ra(a) { var b = Q(T(a)); isNaN(b) && (b = qa[a]); return b } function n(a) { return String(T(a) || "") } function ic(a, b) { f[a] = b } function kb(a) { return f = a } function lb(a) { var b = location.hostname; return b && a ? b === a || -1 !== b.indexOf("." + a, b.length - ("." + a).length) : !0 } function Aa(a) { f[a] = 0 > k(f[a], "#" + a.toUpperCase()) ? f[a] : "" } function Ba(a) {
          var b = a.agentUri; b && -1 < k(b, "_") && (b = /([a-zA-Z]*)[0-9]{0,4}_([a-zA-Z_0-9]*)_[0-9]+/g.exec(b)) &&
            b.length && 2 < b.length && (a.csu = b[1], a.featureHash = b[2])
        } function Ca(a, b) { lb(f.domain || "") || (f.domainOverride = location.hostname + "," + f.domain, delete f.domain); f.pVO && (a.pVO = f.pVO); b || (a.bp = a.bp || qa.bp, 1 === g && a.bp1 && (a.bp = 1), a.bp2 && (a.bp = 2), 4 !== a.bp || e.JSON || (a.bp = 1)) } function jc() { return f } function F(a, b) { try { var c = da; c && c.setItem(a, b) } catch (d) { } } function ea(a) { try { var b = da; if (b) return b.getItem(a) } catch (c) { } return null } function fa(a) { try { var b = da; b && b.removeItem(a) } catch (c) { } } function sa(a, b) {
          if (G() &&
            (!x().v || mb)) return a.apply(this, b || [])
        } function G() { return !m("coo") || m("cooO") || mb } function p(a) { document.cookie = a + '="";path=/' + (n("domain") ? ";domain=" + n("domain") : "") + "; expires=Thu, 01 Jan 1970 00:00:01 GMT;" } function nb(a, b, c) { var d = 1, e = 0; do document.cookie = a + '=""' + (b ? ";domain=" + b : "") + ";path=" + c.substr(0, d) + "; expires=Thu, 01 Jan 1970 00:00:01 GMT;", d = c.indexOf("/", d), e++; while (-1 !== d && 5 > e) } function E(a) {
          var b = document.cookie; if (!b) return ""; var c = a + "="; a = k(b, c); if (0 > a) return ""; for (; 0 <= a;)if (a &&
            " " !== b.charAt(a - 1) && ";" !== b.charAt(a - 1)) a = k(b, c, a + c.length); else return c = a + c.length, a = k(b, ";", a), 0 <= a ? b.substring(c, a) : b.substr(c); return ""
        } function kc(a, b, c, d) { b || 0 === b ? (b = ("" + b).replace(/[;\n\r]/g, "_"), a = a + "=" + b + ";path=/" + (n("domain") ? ";domain=" + n("domain") : ""), c && (a += ";expires=" + c.toUTCString()), d && (a += ";Secure"), document.cookie = a) : p(a) } function y(a, b, c, d) { sa(kc, [a, b, c, d]) } function ob(a) {
          var b = /^[0-9A-Za-z_=:\$\+\/\.\-\*%\|]*$/.test(a); return 0 === g && (0 >= k(a, "$") && -1 === k(a, "=srv=") || a && 2 < a.split("$").length) ?
            !1 : b
        } function pb() { var a = E(D); return a && ob(a) ? a : "" } function U(a) { y(D, a, void 0, m("ssc")) } function V(a) { return 32 === a.length || 12 >= a.length ? a : "" } function qb(a) { return !isNaN(a) && 3 >= a.length ? a : "" } function rb(a) { var b = { sessionId: "", b: "" }, c = k(a, "|"), d = a; -1 !== c && (d = a.substring(0, c)); c = k(d, "$"); -1 !== c ? (b.sessionId = V(d.substring(c + 1)), b.b = qb(d.substring(0, c))) : b.sessionId = V(d); return b } function sb(a) {
          var b = { sessionId: "", b: "" }; a = a.split("="); if (2 < a.length && !(a.length % 2)) {
            var c = Number(a[1]); if (isNaN(c) || 3 > c) return b;
            for (var c = {}, d = 2; d < a.length; d++)c[a[d]] = a[d + 1], d++; b.sessionId = V(c.sn); c.srv && (b.b = qb(c.srv)); "1" === c.ol && (F("dtDisabled", "true"), x().disabled = !0, x().v = !0)
          } return b
        } function H(a) {
          var b = document.cookie ? document.cookie.split(a).length - 1 : 0; if (1 < b) {
            var c = n("domain") || e.location.hostname, d = e.location.hostname, f = e.location.pathname, g = 0, l = 0; z.push(a); do {
              var k = d.substr(g); if (k !== c || "/" !== f) { nb(a, k === c ? "" : k, f); var h = document.cookie ? document.cookie.split(a).length - 1 : 0; h < b && (z.push(k), b = h) } g = d.indexOf(".", g) +
                1; l++
            } while (g && 10 > l && 1 < b); n("domain") && 1 < b && nb(a, "", f)
          }
        } function lc() { H(R); H(D); H(oa); H("rxvt"); Wa(function (a, b, c, d) { 0 < z.length && !b && (a.av(d, 0, "dCN", function () { return z.join(",") }), a.av(d, 4, "duplicateCookieNames", function () { return z.slice() }), z = []) }) } function mc() { return W } function Da(a, b, c, d) {
          var e = document.createElement("script"); e.setAttribute("src", a); b && e.setAttribute("defer", "true"); c && (e.onload = c); d && (e.onerror = d); e.setAttribute("crossorigin", "anonymous"); a = document.getElementsByTagName("script")[0];
          a.parentElement.insertBefore(e, a)
        } function Ea(a, b) { return Fa + "/" + (b || I) + "_" + a + "_" + (ra("buildNumber") || x().version) + ".js" } function ta(a) { G() ? a() : (t || (t = []), h(t, a)) } function nc(a) { return sa(a) } function oc() { for (var a = 0; a < t.length; a++)aa(t[a], 0); t = []; f.cooO = !0 } function pc() { f.cooO = !1; p(D); p(R); p(oa); p("dtSa"); p(fb()); 0 === g && (p("rxVisitor"), p("rxvt")); try { var a = da; a && (0 === g && a.removeItem("rxVisitor"), a.removeItem(D)); (a = Ga) && a.removeItem(za()) } catch (b) { } } function tb(a) {
          return (a = a || pb()) ? k(a, "=") ? rb(a) :
            sb(a) : { sessionId: "", b: "" }
        } function J(a) { return tb(a).b } function K(a) { return tb(a).sessionId } function qc() { return q } function rc() { ta(function () { K() || U((0 === g ? -1 * P(2, 21) + "$" : "") + w(32)); q = J() || "" }) } function Ha(a) { try { if (e.localStorage) return e.localStorage.getItem(a) } catch (b) { } return null } function ga(a) { try { e.localStorage && e.localStorage.removeItem(a) } catch (b) { } } function ub(a, b) { b = X(b); for (var c = !1, d = 0; d < b.length; d++)b[d].frameId === W && (b[d].g = a, c = !0); c || h(b, { frameId: W, g: a }); ha(b) } function ha(a, b) {
          var c =
            ""; if (a) { for (var c = [], d = 0; d < a.length; d++)"-" !== a[d].g && (0 < d && 0 < c.length && h(c, "p"), 0 === g && (h(c, q), h(c, "$")), h(c, a[d].frameId), h(c, "h"), h(c, a[d].g)); 0 === g && (c.length || (Ia && (L(0, !0), Ja(!1)), q = J() || "", h(c, q), h(c, "$"), h(c, W), h(c, "h-")), h(c, "v"), h(c, b || Ka())); c = c.join("") } c || (c = "-", 0 === g && (Ia && (L(0, !0), Ja(!1)), q = J() || "", c = q + "$" + W + "h-v" + (b || Ka()))); y(R, c, void 0, m("ssc"))
        } function X(a) {
          var b = E(R), c = []; if (b && "-" !== b) for (var b = b.split("p"), d = 0; d < b.length; d++) {
            var e = b[d].split("h"); if (2 === e.length && e[0] && e[1]) {
              var f =
                e[0]; if (0 === g && (f && 0 <= k(f, "$") && (f = f.split("$")[1]), 0 <= k(e[1], "v"))) { var l = e[1].split("v"); if (2 === l.length) { var n = l[1]; e[1] = l[0] } } if (!(l = a)) { var l = Q(f.split("_")[0]), m = r() % La; m < l && (m += La); l = l + 9E5 > m } l && h(c, { frameId: f, g: e[1] })
            }
          } if (0 === g) for (a = 0; a < c.length; a++)c[a].visitId = n || ""; return c
        } function Ka() { return Ma() || L(0, !0) } function Ma() { var a = X(!0); if (!(Na() <= r())) { A(!1); if (a && 1 <= a.length) return a[0].visitId || ""; (a = Ha(M)) || (a = ea(M)); return a || "" } return "" } function A(a) {
          var b = r(), c = vb().j; a && (c = b); wb(b +
            xb + "|" + c); yb()
        } function zb(a) { a || (a = P(1, 1E6)); var b = K() || ""; b || (b = (0 === g ? -1 * P(2, 21) + "$" : "") + w(32), U(b), b = K(b) || ""); a = "" + a; for (var c = a.length, d = [], e = 0; e < b.length; e++)d[e] = String.fromCharCode(65 + Math.abs((b.charCodeAt(e) ^ a.charCodeAt(e % c)) % 26)); b = d.join(""); for (a = 0; a < Oa.length; a++)Oa[a](b, Y); return b } function Pa(a) { var b = X(!1); ha(b, a); Qa(M, a); A(!0) } function L(a, b) { b && (Y = !0); a = zb(r()); Pa(a); return a } function sc(a) { Oa.push(a) } function yb() { Ra && Va(Ra); Ra = aa(Ab, Na() - r()) } function Ab() {
          if (Na() <= r() && G()) {
            var a =
              zb(r()); Pa(a); return !0
          } ta(yb); return !1
        } function wb(a) { y("rxvt", a, void 0, m("ssc")); Qa("rxvt", a) } function Qa(a, b) { if (m("dpvc") || m("pVO")) F(a, b), ga(a); else { try { e.localStorage && e.localStorage.setItem(a, b) } catch (c) { } fa(a) } } function Bb() { var a = E("rxvt"); a || (a = Ha("rxvt") || "") || (a = ea("rxvt") || ""); return a } function Cb() { var a = Ma() || ""; Qa(M, a); a = Bb(); wb(a) } function vb() { var a = { m: 0, j: 0 }, b = Bb(); if (b) try { var c = b.split("|"); 2 === c.length && (a.m = parseInt(c[0], 10), a.j = parseInt(c[1], 10)) } catch (d) { } return a } function Na() {
          var a =
            vb(); return Math.min(a.m, a.j + Db)
        } function tc(a) { xb = a } function Ja(a) { void 0 === a && (a = !0); Ia = a } function uc() { var a = Y; Y = !1; return a } function vc() { Ab() || A(!1) } function Sa() { var a = E("rxVisitor"); if (!a || a.length && a.length !== Ta) a = ea("rxVisitor"), a && a.length === Ta || (Eb = !0, a = r() + "", a += w(Ta - a.length)); var b = a; if (!m("dpvc") && !m("pVO")) { var c = new Date; c.setFullYear(c.getFullYear() + 2) } y("rxVisitor", b, c, m("ssc")); F("rxVisitor", b); return a } function wc() { return Eb } function xc(a) {
          var b = E("rxVisitor"); p("rxVisitor");
          fa("rxVisitor"); y("rxVisitor", b); f.pVO = !0; if (a) try { e.localStorage && e.localStorage.setItem(Ua, "1") } catch (c) { } Cb()
        } function yc() { ga(Ua); m("pVO") && (f.pVO = !1, Sa()); Cb() } function zc() {
        e.dT_ = {
          version: "10163190220134628", cfg: e.dT_ ? e.dT_.cfg : "", iCE: e.dT_ ? e.dT_.iCE : function () { return navigator.cookieEnabled }, ica: 1, disabled: !1, v: !1, gx: Gb, cx: Hb, mp: Ub, mtp: Wb, mi: Yb, mw: $b, gAST: Qb, ww: Nb, stu: Kb, nw: r, apush: h, st: aa, si: Jb, aBPSL: Wa, gBPSL: Ib, aBPSCC: Ob, gBPSCC: Pb, buildType: 0 === g ? "dynatrace" : "appmon", gSSV: ea, sSSV: F, rSSV: fa,
          rvl: ga, pn: Q, iVSC: ob, p3SC: sb, pLSC: rb, io: k, dC: p, sC: y, esc: Sb, gSId: J, gDtc: K, gSC: pb, sSC: U, gC: E, cRN: P, cRS: w, gEL: bb, gEBTN: ab, gSCN: bc, gPCHN: cc, gRHN: dc, gPCCN: fc, gLCN: ec, gMSIDCN: fb, cfgO: jc, pCfg: jb, pCSAA: pa, cFHFAU: Ba, sCD: Ca, bcv: m, ncv: ra, scv: n, stcv: ic, rplC: kb, cLSCK: za, gFId: mc, gBAU: Ea, iS: Da, eWE: ta, oEIE: nc, oEIEWA: sa, eA: oc, dA: pc, gcSId: qc, iNV: wc, gVID: Sa, dPV: xc, ePV: yc, sVIdUP: Ja, sVTT: tc, sVID: Pa, rVID: Ma, gVI: Ka, gNVId: L, gARnVF: uc, cAUV: vc, uVT: A, aNVL: sc, gPC: X, cPC: ub, sPC: ha, clB: Rb, ct: Va, aRI: hb, iXB: ib, gXBR: gc, sXBR: hc, de: gb,
          cCL: cb
        }
        } var B = window; if (!B.dT_ || !B.dT_.cfg || "string" != typeof B.dT_.cfg || B.dT_.initialized) B.console && B.console.log("Initconfig not found or agent already initialized! This is an injection issue."); else if (!(navigator.userAgent && 0 <= navigator.userAgent.indexOf("RuxitSynthetic"))) {
          var e = "undefined" !== typeof window ? window : self, ka, la, wa, Za = [], xa, Ga, da, ba = {}, Tb = new (function () {
            return function () {
            this["!"] = "%21"; this["~"] = "%7E"; this["*"] = "%2A"; this["("] = "%28"; this[")"] = "%29"; this["'"] = "%27"; this.$ = "%24";
              this[";"] = "%3B"; this[","] = "%2C"
            }
          }()), na, Xa, Zb = e.postMessage, Ya = e.Worker, Lb = e.Blob, Mb = e.URL && e.URL.createObjectURL, ac = e.Worker && e.Worker.prototype.postMessage, Vb = e.parent.postMessage, Xb = e.top.postMessage, O, ya, ca = !1, g, qa, R = "dtPC", D = "dtCookie", db = "x-dtpc", eb = "x-dtreferer", oa = "dtLatC", S, f = {}, mb = !!navigator.userAgent && 0 <= navigator.userAgent.indexOf("RuxitSynthetic"), z = [], W, La = 6E8, Fb, Fa, I, Ac = { childList: !0, subtree: !0, attributes: !0, attributeOldValue: !0 }, Bc = ["_DT_RENDERING_"], t = [], q, M = "rxvisitid", Ra, xb = 18E5,
          Db = 216E5, Y = !1, Oa = [], Ia = !1, Ua = "dt-pVO", Ta = 45, Eb = !1; (function (a) {
            try {
              g = a; var b = e.dT_; ka = e.XMLHttpRequest; la = e.ActiveXObject; na = e.setTimeout; Xa = e.setInterval; ca || (O = e.clearTimeout, ya = e.clearInterval); if (b.iCE && !b.iCE() || !navigator.cookieEnabled) return !1; zc(); try { Ga = e.localStorage, da = e.sessionStorage } catch (ua) { } xa = r(); wa = []; ba = {}; ca || (e.clearTimeout = $a(O), e.clearInterval = $a(ya), ca = !0); W = xa % La + "_" + Q(P(0, 1E3) + ""); qa = {
                ade: "", agentLocation: "", agentname: "", agentUri: "", uana: "data-dtname,data-dtName", app: "",
                async: !1, auto: !1, bandwidth: "300", bp1: !1, bp2: !1, bp: 0 === g ? 1 : 2, bs: !1, buildNumber: 0, coo: !1, cooO: !1, cors: !1, csu: "", cux: !1, dataDtConfig: "", debugName: "", disableCookieManager: !1, disableLogging: !1, dmo: !1, dpvc: !1, disableXhrFailures: !1, domain: "", domainOverride: "", doNotDetect: "", dsndb: !1, dsss: !1, euf: !1, evl: "", extblacklist: "", exteventsoff: !1, fa: !1, featureHash: "", ffi: !1, hvt: 216E5, lastModification: 0, imm: !1, initializedModules: "", ign: "", instr: "", lab: !1, legacy: !1, lmut: !0, lzwd: !1, lzwe: !1, md: "", name: "", mdn: 5E3, mepp: 10,
                moa: 30, mrt: 3, msl: 3E4, mhl: 4E3, ncw: !1, ntd: !1, oat: 180, ote: !1, perfbv: 1, pui: !1, pVO: !1, rdnt: 0, reportUrl: "dynaTraceMonitor", restoreTimeline: !1, rid: "", ridPath: "", rpid: "", rt: 0 === g ? 1E4 : 0, rtl: 0 === g ? 0 : 100, rtp: 0 === g ? 2 : 1, rtt: 1E3, rtu: 200, rx_visitID: "", sl: 100, sosi: !1, spc: "", srbbv: 1, srbw: !0, srad: !0, srmr: 100, srms: "1,1,,,", srsr: 1E5, srtbv: 3, srtd: 1, srtr: 500, srwo: !1, ssc: !1, st: 3E3, svNB: !1, syntheticConfig: !1, tal: 0, tp: "500,50,3", tt: 100, tvc: 3E3, uam: !1, useNewCookies: !1, uxrgce: !0, uxrgcm: "100,25,300,3;100,25,300,3", vcfi: !1, WST: !1,
                xb: "", xmut: !0, xt: 0
              }; a: {
                var c = x().cfg; f = { reportUrl: "dynaTraceMonitor", initializedModules: "", csu: "dtagent", dataDtConfig: "string" === typeof c ? c : "" }; x().cfg = f; 0 === g && (f.csu = "ruxitagentjs"); var d = f.dataDtConfig; d && -1 === k(d, "#CONFIGSTRING") && (pa(d, f), Aa("domain"), Aa("auto"), Aa("app"), Ba(f)); var h = ab("script"), p = bb(h), l = -1 === k(f.dataDtConfig || "", "#CONFIGSTRING") ? f : null; if (0 < p) for (a = 0; a < p; a++)b: {
                  var b = void 0, q = h[a], c = l; if (q.attributes) {
                    var y = f.csu + "_bootstrap.js", d = /.*\/jstag\/.*\/.*\/(.*)_bs(_dbg)?.js$/,
                    z = c, N = q.src, t = N && N.indexOf(y), B = q.attributes.getNamedItem("data-dtconfig"); if (B) { var w = N, F = B.value, u = {}; f.legacy = !0; if (w) { var Z = /([a-zA-Z]*)[0-9]{0,4}_([a-zA-Z_0-9]*)_([0-9]+)/g.exec(w); Z && Z.length && (u.csu = Z[1], u.featureHash = Z[2], 0 === g && (u.agentLocation = w.substr(0, k(w, Z[1]) - 1), u.buildNumber = Z[3])) } F && pa(F, u, !0); lb(u.domain) || (u.domainOverride = location.hostname + "," + u.domain, delete u.domain); b = u; if (!c) z = b; else if (!b.syntheticConfig) { l = b; break b } } b || (b = f); if (t && 0 <= t) {
                      var H = t + y.length + 5; b.app = N.length >
                        H ? N.substr(H) : "Default%20Application"
                    } else if (N) { var J = d.exec(N); J && (b.app = J[1]) } l = z
                  } else l = c
                } if (l) for (var K in l) l.hasOwnProperty(K) && (h = K, f[h] = l[h]); f.rx_visitID && (x().rx_visitID = f.rx_visitID); var X = za(); try {
                  var L = (l = Ga) && l.getItem(X); if (L) {
                    var ia = jb(L), v = pa(ia.config || ""), A = f.lastModification || "0", M = Q((v.lastModification || ia.lastModification || "0").substr(0, 13)), Y = "string" === typeof A ? Q(A.substr(0, 13)) : A; if (!A || M >= Y) if (v.agentname = ia.name, v.agentUri ? Ba(v) : (v.csu = ia.name, v.featureHash = ia.featureHash),
                      Ca(v, !0), ib(v), hb(v), M > (f.lastModification || 0)) { var aa = m("auto"); f = kb(v); f.auto = aa }
                  }
                } catch (ua) { } Ca(f); try { var S = f.ign; if (S && (new RegExp(S)).test(e.location.href)) { document.dT_ = e.dT_ = void 0; var ja = !1; break a } } catch (ua) { } f.useNewCookies && 0 === g && (R = "rxpc", D = "rxsession", oa = "rxlatency", db = "x-rxpc", eb = "x-rxreferer"); ja = !0
              } if (!ja) return !1; lc(); try { Fb = x().disabled || !!ea("dtDisabled") } catch (ua) { } var va; if (!(va = n("agentLocation"))) a: {
                var T = n("agentUri"); if (T || document.currentScript) {
                  var C = T || document.currentScript.src;
                  if (C) { var fa = -1 === k(C, "_bs") && -1 === k(C, "_bootstrap") && -1 === k(C, "_complete") ? 1 : 2, G = C.lastIndexOf("/"); for (ja = 0; ja < fa && -1 !== G; ja++)C = C.substr(0, G), G = C.lastIndexOf("/"); va = C; break a }
                } var U = location.pathname; va = U.substr(0, U.lastIndexOf("/"))
              } Fa = va; I = n("agentname") || n("csu") || (0 === g ? "ruxitagentjs" : "dtagent"); "true" === E("dtUseDebugAgent") ? 0 > I.indexOf("dbg") && (I = n("debugName") || I + "dbg") : I = n("name") || I; if (!m("auto") && !m("legacy") && !Fb) {
                var V = n("agentUri") || Ea(n("featureHash")); m("async") || "complete" === document.readyState ?
                  Da(V, m("async")) : document.write('<script type="text/javascript" src="' + V + '">\x3c/script>')
              } var ga = e.location.href; 0 === g && -1 !== k(ga, "_DT_RENDERING_") && (x().RMOD = { conf: Ac, ignore: Bc, ID: "_DT_RENDERING_" }, Fa && Da(Ea("R"), !0)); E(D) && (f.cooO = !0); rc(); if (0 === g) { var ha = !!Ha(Ua); f.pVO = ha; ta(Sa) } 0 === g && ra("hvt") && (Db = ra("hvt")); sa(ub, [1])
            } catch (ua) { return !1 } return !0
          })(0) || (delete e.dT_, cb() && e.console.log("JsAgent initCode initialization failed!"))
        }
      })();
    }).call(this);


  </script>
  <script>
    var branchName = "";
    var docTitle = "Production Deployments";
    var iconFile = "https:\/\/keptn.sh\//img/icons.svg";
    var buttonCopy = '';
    var buttonPrint = '';
    var buttonDownload = '';
  </script>
</head>

<body class='page '>
  
<div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-docs">
      <a href="/docs/">
        
        <span>Docs</span>
      </a>
    </li>
    
    <li class="menu-item-about">
      <a href="/about/">
        
        <span>About</span>
      </a>
    </li>
    
  </ul>
</div>

  <div class="wrapper">

    <div class='header fixed-top'>
  <div class="container">
    <div class="logo">
      <a href="https://keptn.sh/"><img alt="Keptn Homepage" src="https://keptn.sh/images/logo.svg" /></a>
    </div>
    <div class="logo-mobile">
      <a href="https://keptn.sh/"><img alt="Keptn Homepage" src="https://keptn.sh/images/logo-mobile.svg" /></a>
    </div>
    
<div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-docs">
      <a href="/docs/">
        
        <span>Docs</span>
      </a>
    </li>
    
    <li class="menu-item-about">
      <a href="/about/">
        
        <span>About</span>
      </a>
    </li>
    
  </ul>
</div>

    
<button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" role="presentation" aria-label="mobile menu trigger">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>

  </div>
</div>
    <a href="https://github.com/keptn/" class="github-corner" aria-label="Keptn on GitHub">
  <svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true">
    <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z" fill="#151513"></path>
    <path class="octo-arm" d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="#ffffff" style="transform-origin: 130px 106px;"></path>
    <path class="octo-body" d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="#ffffff"></path>
  </svg>
</a>
    <div class="main">
    
<div class="container">




    <div class="primary">


    <div id="sidebar-container" class="sidebar-container sidebar-offcanvas">
        
        
            <nav class="sidebar">
    <div class="spacer"></div>
    <div class="directory" role="tablist">
        

        
        

        
            
        
            

                <div class="card">
                    <div class="card-header" role="tab" id="header1">
                        <a data-toggle="collapse" href="#collapse1" title="" role="button" aria-controls="collapse1">
                            <div><svg class="icon"><use xlink:href="/img/icons.svg#docs"/></svg>Release 0.1.0</div>
                        </a>
                    </div>

                    <div id="collapse1" class="collapse show" role="tabpanel" aria-labelledby="header1">
                        <div class="card-body">
                            




<ul class="tree">
    
        
    
        
    
        
    
        
    
        
            
                <li class="sublist">
                    

                    <label class='tree-toggle'><i class="chevron show"><svg class="icon"><use xlink:href="/img/icons.svg#right-chevron"/></svg></i><i class="chevron"><svg class="icon"><use xlink:href="/img/icons.svg#down-chevron"/></svg></i><a  title="How to deploy keptn in Kubernetes." href="https://keptn.sh/docs/0.1.0/setup/">Setup</a>
                    </label>

                    




<ul class="tree collapse">
    
        
    
        
    
        
            
                <li class="sublist">
                    

                    <label class='tree-toggle'><i class="chevron show"><svg class="icon"><use xlink:href="/img/icons.svg#right-chevron"/></svg></i><i class="chevron"><svg class="icon"><use xlink:href="/img/icons.svg#down-chevron"/></svg></i><a  title="Instructions for installing keptn on AWS EKS." href="https://keptn.sh/docs/0.1.0/setup/eks/">AWS EKS</a>
                    </label>

                    




<ul class="tree collapse">
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            
                <li>
                    
                        <a title="Demonstrates how to install keptn in a Kubernetes cluster on Amazon EKS." href="https://keptn.sh/docs/0.1.0/setup/eks/install-keptn-v.0.1/">Install keptn v.0.1 on AWS EKS</a>
                    
                </li>
             
        
    
        
    
</ul>

                </li>
            
        
    
        
            
                <li class="sublist">
                    

                    <label class='tree-toggle'><i class="chevron show"><svg class="icon"><use xlink:href="/img/icons.svg#right-chevron"/></svg></i><i class="chevron"><svg class="icon"><use xlink:href="/img/icons.svg#down-chevron"/></svg></i><a  title="Instructions for installing keptn on Kubernetes." href="https://keptn.sh/docs/0.1.0/setup/kubernetes/">Kubernetes</a>
                    </label>

                    




<ul class="tree collapse">
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            
                <li>
                    
                        <a title="Demonstrates how to install keptn in a Kubernetes cluster on Google Container Engine (GKE)." href="https://keptn.sh/docs/0.1.0/setup/kubernetes/install-keptn-v.0.1/">Install keptn v.0.1 on GKE</a>
                    
                </li>
             
        
    
</ul>

                </li>
            
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
</ul>

                </li>
            
        
    
        
    
        
    
        
    
        
    
        
            
                <li class="sublist">
                    

                    <label class='tree-toggle'><i class="chevron"><svg class="icon"><use xlink:href="/img/icons.svg#right-chevron"/></svg></i><i class="chevron show"><svg class="icon"><use xlink:href="/img/icons.svg#down-chevron"/></svg></i><a  title="How to do specific targeted activities with keptn." href="https://keptn.sh/docs/0.1.0/usecases/">Use Cases</a>
                    </label>

                    




<ul class="tree">
    
        
    
        
    
        
    
        
    
        
    
        
            
                <li>
                    
                        <a title="Shows you how to setup a fully automated on-demand self-service model for performance testing." href="https://keptn.sh/docs/0.1.0/usecases/performance-as-a-service/">Performance as a Service</a>
                    
                </li>
             
        
    
        
            
                <li>
                    
                        <span class="current" title="Gives an overview of production deployments, deployment strategies, and depicts those using Istio on Kubernetes to canary-deploy a new front-end version.">Production Deployments</span>
                    
                </li>
             
        
    
        
            
                <li>
                    
                        <a title="Gives an overview of how to leverage the power of runbook automation to build self-healing applications. Therefore, you will use Ansible Tower as the tool for executing and managing the runbooks." href="https://keptn.sh/docs/0.1.0/usecases/runbook-automation-and-self-healing/">Runbook Automation and Self-healing</a>
                    
                </li>
             
        
    
        
            
                <li>
                    
                        <a title="Shows you how to implement a delivery pipeline that prevents bad code changes from impacting your end users." href="https://keptn.sh/docs/0.1.0/usecases/unbreakable-delivery-pipeline/">Unbreakable Delivery Pipeline</a>
                    
                </li>
             
        
    
        
    
        
    
        
    
</ul>

                </li>
            
        
    
        
    
        
    
</ul>

                        </div>
                    </div>
                </div>
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        

        
            
        
    </div>
</nav>

        
    </div>

    <div class="article-container">
        
            <label class="sidebar-toggler" id="sidebar-toggler" title=''>
                <svg class="icon"><use xlink:href="/img/icons.svg#pull"/></svg>
            </label>
        

        <div class="pagenav">
            <p>


    
        
        
        
    

    
        
        
        
    

    
        
        
        
    

    
        
        
        
    

    
        
        
        
    




    
    
    

    
        <a href="https://keptn.sh/">Home</a>
        <span>/</span>
    

    
    
    

    
        <a href="https://keptn.sh/docs/">Docs</a>
        <span>/</span>
    

    
    
    

    
        <a href="https://keptn.sh/docs/0.1.0/">Release 0.1.0</a>
        <span>/</span>
    

    
    
    

    
        <a href="https://keptn.sh/docs/0.1.0/usecases/">Use Cases</a>
        <span>/</span>
    

    
    
    

    
        Production Deployments
    

</p>
        </div>

        <main aria-labelledby="title">
            <h1 id="title">Production Deployments</h1>

            



            
                <nav class="toc-inlined">
                    <hr/>
                    <div class="directory" role="directory">
                        











    
    

    
        
        <nav id="InlinedTableOfContents">
            <ul>
                
                
                    
                    
                    
                    

                    

                    <li><a href="#about-this-use-case">About this use case</a></li>

                    
                
                    
                    
                    
                    

                    

                    <li><a href="#step-1-verify-istio-installation-and-deploy-sockshop-to-production">Step 1: Verify Istio installation and deploy sockshop to production</a></li>

                    
                
                    
                    
                    
                    

                    

                    <li><a href="#step-2-access-ingress-gateway">Step 2: Access ingress gateway</a></li>

                    
                
                    
                    
                    
                    

                    

                    <li><a href="#step-3-create-front-end-v2">Step 3. Create front-end v2</a></li>

                    
                
                    
                    
                    
                    

                    

                    <li><a href="#step-4-deploy-front-end-v2-to-production">Step 4. Deploy front-end v2 to production</a></li>

                    
                
                    
                    
                    
                    

                    

                    <li><a href="#step-5-istio-traffic-routing">Step 5. Istio traffic routing</a></li>

                    
                
                    
                    
                    
                    

                    
                        
                        
                            <ul>
                        
                    

                    <li><a href="#optional-redirect-only-logged-in-users">(optional) Redirect only logged in users</a></li>

                    
                
                    
                    
                    
                    

                    

                    <li><a href="#optional-redirect-only-chrome-users">(optional) Redirect only Chrome users</a></li>

                    
                
                    
                    
                    
                    

                    
                        
                        
                            </ul>
                        
                    

                    <li><a href="#step-6-cleanup">Step 6. Cleanup</a></li>

                    
                
                    
                    
                    
                    

                    

                    <li><a href="#understanding-what-happened">Understanding what happened</a></li>

                    
                

                
                

                
            </ul>
        </nav>
    


                    </div>
                    <hr/>
                </nav>
            




<p>This use case gives an overview of production deployments, deployment strategies, and depicts those using Istio on Kubernetes to canary-deploy a new front-end version.</p>

<h2 id="about-this-use-case">About this use case</h2>

<p>When developing an application, sooner or later you need to update a service in a production environment. To conduct this in a controlled manner and without impacting end-user experience,  deployment strategies must be in place. For example, blue-green or canary deployment are well known strategies to rollout a new service version. Additionally, these strategies keep the previous service available if something goes wrong.</p>

<p>To illustrate the benefit this use case addresses, you will create a second version of the front-end service, which has another background color in the header component. Then, this version will be deployed to the production environment in a dark-launch manner. To route traffic to this new service version, the configuration of a virtual service will be changed by setting weights for the routes. In other words, this configuration change defines how much traffic is routed to the old and to the new version of the front-end service.</p>

<p>Optionally, you can try the additional virtual service configurations that redirect signed-in users or users with a Chrome browser to the new front-end version.</p>


<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="//www.youtube.com/embed/IFegk6BtN8I" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>


<h2 id="step-1-verify-istio-installation-and-deploy-sockshop-to-production">Step 1: Verify Istio installation and deploy sockshop to production</h2>

<ol>
<li><p>To verify the installation of Istio, execute the <code>kubectl get services -n istio-system</code> command:</p>

<pre><code class="language-console">$ kubectl get services -n istio-system
NAME                     TYPE           CLUSTER-IP      EXTERNAL-IP     PORT(S)                                          AGE
grafana                  ClusterIP      10.23.248.137   &lt;none&gt;          3000/TCP                                         10h
istio-citadel            ClusterIP      10.23.245.163   &lt;none&gt;          8060/TCP,9093/TCP                                10h
istio-egressgateway      ClusterIP      10.23.250.121   &lt;none&gt;          80/TCP,443/TCP                                   10h
istio-galley             ClusterIP      10.23.246.195   &lt;none&gt;          443/TCP,9093/TCP                                 10h
istio-ingressgateway     LoadBalancer   10.23.245.251   **.184.232.**   80:31380/TCP,443:31390/TCP,31400:31400/TCP,...   10h
istio-pilot              ClusterIP      10.23.242.171   &lt;none&gt;          15010/TCP,15011/TCP,8080/TCP,9093/TCP            10h
istio-policy             ClusterIP      10.23.245.9     &lt;none&gt;          9091/TCP,15004/TCP,9093/TCP                      10h
istio-sidecar-injector   ClusterIP      10.23.255.240   &lt;none&gt;          443/TCP                                          10h
istio-telemetry          ClusterIP      10.23.244.185   &lt;none&gt;          9091/TCP,15004/TCP,9093/TCP,42422/TCP            10h
</code></pre></li>

<li><p>Ensure that the label <code>istio-injection</code> has only been applied to the production namespace by executing the <code>kubectl get namespace -L istio-injection</code> command:</p>

<pre><code class="language-console">$ kubectl get namespace -L istio-injection
NAME           STATUS    AGE       ISTIO-INJECTION
cicd           Active    10h
default        Active    10h
dev            Active    10h
dynatrace      Active    10h
istio-system   Active    10h        disabled
kube-public    Active    10h
kube-system    Active    10h
production     Active    10h        enabled
staging        Active    10h
</code></pre></li>

<li><p>Trigger the <code>k8s-deploy-production</code> pipeline in your Jenkins instance (see :one:). This promotes all components that are currently in the <em>staging</em> namespace to the <em>production</em> namespace.</p>

<figure style="width:100%">
    <div class="wrapper-with-intrinsic-ratio" style="padding-bottom:%">
        <a data-lightbox="lightbox" class="not-for-endnotes" href="/docs/0.1.0/usecases/production-deployments/./assets/trigger-k8s-deploy-production.png" title="Trigger k8s-deploy-production">
            <img class='popup-image element-to-stretch' src="/docs/0.1.0/usecases/production-deployments/./assets/trigger-k8s-deploy-production.png" alt="Trigger k8s-deploy-production" />
        </a>
    </div>
    <figcaption>Trigger k8s-deploy-production</figcaption>
</figure>


<p>This pipeline reads the current versions of all artefacts in the <em>staging</em> namespace and deploys those artefacts in the exact same version to the <em>production</em> namespace. Instead of pushing individual microservices to production, we chose the approach of defining a release bracket, which holds versions of microservices that work together well.</p></li>
</ol>

<h2 id="step-2-access-ingress-gateway">Step 2: Access ingress gateway</h2>

<ol>
<li><p>Run the <code>kubectl get svc istio-ingressgateway -n istio-system</code> command to get the <em>EXTERNAL-IP</em> of your <em>Gateway</em>.</p>

<pre><code class="language-console">$ kubectl get svc istio-ingressgateway -n istio-system
NAME                   TYPE           CLUSTER-IP       EXTERNAL-IP     PORT(S)                                      AGE
istio-ingressgateway   LoadBalancer   172.21.109.129   1**.2**.1**.1**  80:31380/TCP,443:31390/TCP,31400:31400/TCP   17h
</code></pre></li>
</ol>

<h2 id="step-3-create-front-end-v2">Step 3. Create front-end v2</h2>

<p>In this step, you create an <em>improved</em> version of the front-end service. You will change the color of the application header to see the effect of traffic routing between two different artefact versions.</p>

<ol>
<li><p>Edit the file <code>public/topbar.html</code> in the master branch of the <code>~/keptn/repositories/front-end</code> repository and change the following lines as depicted in the screenshot:</p>

<figure style="width:100%">
    <div class="wrapper-with-intrinsic-ratio" style="padding-bottom:%">
        <a data-lightbox="lightbox" class="not-for-endnotes" href="/docs/0.1.0/usecases/production-deployments/./assets/change-topbar-html.png" title="Change topbar of front-end">
            <img class='popup-image element-to-stretch' src="/docs/0.1.0/usecases/production-deployments/./assets/change-topbar-html.png" alt="Change topbar of front-end" />
        </a>
    </div>
    <figcaption>Change topbar of front-end</figcaption>
</figure>
</li>

<li><p>Save the changes to that file.</p></li>

<li><p>Now it&rsquo;s time to commit your changes; first locally, and then push it to the remote repository.</p>

<pre><code class="language-console">$ git add .
$ git commit -m &quot;New more colorful version of front-end service&quot;
$ git push
</code></pre></li>

<li><p>You need the new version of the <code>front-end</code> service in the <em>staging</em> namespace, before you can start with a blue-green or canary deployment. Therefore, create a new release branch in the <code>front-end</code> repository using our Jenkins pipeline:</p>

<ol>
<li>Go to <strong>Jenkins</strong> and <strong>sockshop</strong>.</li>
<li>Click on <strong>create-release-branch</strong> pipeline and <strong>Schedule a build with parameters</strong>.</li>

<li><p>For the parameter <strong>SERVICE</strong>, enter the name of the service you want to create a release for. In this case: <strong>front-end</strong></p>

<p>The pipeline does the following:</p>

<ol>
<li>Reads the current version of the microservice.</li>
<li>Creates a release branch with the name release/<strong>version</strong>.</li>
<li>Increments the current version by 1.</li>
<li>Commits/Pushes the new version to the Git repository.</li>
</ol>

<figure style="width:100%">
    <div class="wrapper-with-intrinsic-ratio" style="padding-bottom:%">
        <a data-lightbox="lightbox" class="not-for-endnotes" href="/docs/0.1.0/usecases/production-deployments/./assets/pipeline_release_branch.png" title="Jenkins pipeline create-release-branch">
            <img class='popup-image element-to-stretch' src="/docs/0.1.0/usecases/production-deployments/./assets/pipeline_release_branch.png" alt="Jenkins pipeline create-release-branch" />
        </a>
    </div>
    <figcaption>Jenkins pipeline create-release-branch</figcaption>
</figure>
</li>
</ol></li>

<li><p>After the <strong>create-release-branch</strong> pipeline has finished, trigger the build pipeline for the <code>front-end</code> service and wait until the new artefacts is deployed to the <em>staging</em> namespace.</p>

<ul>
<li>Wait until the release/<strong>version</strong> build has finished.</li>
</ul></li>

<li><p>To see your changes in the <code>front-end</code> service that is deployed in <em>staging</em>, get the <em>EXTERNAL-IP</em> of the <code>front-end</code> load balancer in <em>staging</em> by listing all services in that namespace.</p>

<pre><code class="language-console">$ kubectl -n staging get services
NAME           TYPE            CLUSTER-IP       EXTERNAL-IP         PORT(S)
carts          ClusterIP       10.11.250.175    &lt;none&gt;              80/TCP
catalogue      ClusterIP       10.11.254.135    &lt;none&gt;              80/TCP
front-end      LoadBalancer    10.11.249.245    1**.2**.3**.4**     8080:31481/TCP
orders         ClusterIP       10.11.251.11     &lt;none&gt;              80/TCP
payment        ClusterIP       10.11.248.211    &lt;none&gt;              80/TCP
queue-master   ClusterIP       10.11.242.139    &lt;none&gt;              80/TCP
rabbitmq       ClusterIP       10.11.255.201    &lt;none&gt;              5672/TCP,9090/TCP
shipping       ClusterIP       10.11.244.162    &lt;none&gt;              80/TCP
user           ClusterIP       10.11.245.147    &lt;none&gt;              80/TCP
user-db-svc    ClusterIP       10.11.243.25     &lt;none&gt;              27017/TCP
</code></pre>

<p>Enter the public IP (e.g., 1<strong>.2</strong>.3<strong>.4</strong>:8080) in your browser and you see the visual improvements you did.</p>

<figure style="width:100%">
    <div class="wrapper-with-intrinsic-ratio" style="padding-bottom:%">
        <a data-lightbox="lightbox" class="not-for-endnotes" href="/docs/0.1.0/usecases/production-deployments/./assets/frontend-v2.png" title="Front-end version 2">
            <img class='popup-image element-to-stretch' src="/docs/0.1.0/usecases/production-deployments/./assets/frontend-v2.png" alt="Front-end version 2" />
        </a>
    </div>
    <figcaption>Front-end version 2</figcaption>
</figure>
</li>
</ol>

<h2 id="step-4-deploy-front-end-v2-to-production">Step 4. Deploy front-end v2 to production</h2>

<p>In this step, you will promote the new version of the <code>front-end</code> service to production.</p>

<ol>
<li><p>In your Jenkins instance, trigger the parameterized pipeline <code>k8s-deploy-production.update</code> (see :one:).</p>

<figure style="width:100%">
    <div class="wrapper-with-intrinsic-ratio" style="padding-bottom:%">
        <a data-lightbox="lightbox" class="not-for-endnotes" href="/docs/0.1.0/usecases/production-deployments/./assets/trigger-production-update.png" title="Trigger production update">
            <img class='popup-image element-to-stretch' src="/docs/0.1.0/usecases/production-deployments/./assets/trigger-production-update.png" alt="Trigger production update" />
        </a>
    </div>
    <figcaption>Trigger production update</figcaption>
</figure>
</li>

<li><p>Enter <code>front-end</code> as service name and <code>v2</code> as new version when asked for parameters to that pipeline.</p>

<figure style="width:100%">
    <div class="wrapper-with-intrinsic-ratio" style="padding-bottom:%">
        <a data-lightbox="lightbox" class="not-for-endnotes" href="/docs/0.1.0/usecases/production-deployments/./assets/enter-parameters.png" title="Parameters for deploy-to-production pipeline">
            <img class='popup-image element-to-stretch' src="/docs/0.1.0/usecases/production-deployments/./assets/enter-parameters.png" alt="Parameters for deploy-to-production pipeline" />
        </a>
    </div>
    <figcaption>Parameters for deploy-to-production pipeline</figcaption>
</figure>


<p>This pipeline reads the version of the passed service in the <em>staging</em> namespace and deploys the artefact in that version to the <em>production</em> namespace in a deployment with the passed version number. After running that pipeline, two deployments of <code>front-end</code> (one with <em>v1</em> and one with <em>v2</em>) are available.</p>

<pre><code class="language-console">$ kubectl -n production get deployment
NAME           DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
...
front-end-v1   1         1         1            1           10h
front-end-v2   1         1         1            1           32s
...
</code></pre>

<p>At this stage, the <strong>VirtualService</strong> for sockshop is configured to use <em>v1</em> initially. So, the application is not affected at all by the deployment of a new version in the <em>production</em> namespace. You can check the details of the deployments to see that each deployment uses a different artefact version, e.g. <code>0.5.0</code> and <code>0.6.0</code>, in the example below:</p>

<pre><code class="language-console">$ kubectl -n production describe deployment front-end-v1
...
Pod Template:
Labels:  app=front-end
         version=v1
Containers:
front-end:
    Image:      10.11.249.13:5000/library/sockshop/front-end-0.5.0
    Port:       8080/TCP
    Host Port:  0/TCP
...
</code></pre>

<pre><code class="language-console">$ kubectl -n production describe deployment front-end-v2
...
Pod Template:
Labels:  app=front-end
         version=v2
Containers:
front-end:
    Image:      10.11.249.13:5000/library/sockshop/front-end-0.6.0
    Port:       8080/TCP
    Host Port:  0/TCP
...
</code></pre></li>
</ol>

<h2 id="step-5-istio-traffic-routing">Step 5. Istio traffic routing</h2>

<p>In this step, you will configure traffic routing in Istio to redirect traffic based on different criteria to <em>v2</em> of the <code>front-end</code> service. It addresses the tasks to redirect traffic using weight rules, redirect only logged in users, and to redirect only Chrome users to v2.</p>

<ol>
<li><p>Right now, traffic to <code>front-end</code> is routed to <em>v1</em> due to the configuration of the <strong>VirtualService</strong>. The <code>subset: v1</code> entry in the configuration takes care of that.</p>

<p>```yaml
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
name: sockshop
spec:
hosts:</p>

<ul>
<li>&ldquo;*&rdquo;
gateways:</li>
<li>sockshop-gateway
http:</li>
<li>route:

<ul>
<li>destination:
host: front-end.production.svc.cluster.local
subset: v1
```</li>
</ul></li>
</ul></li>

<li><p>To see if the new version works properly, 10% of the traffic can be redirected to that version. Therefore, it is necessary to modify the <code>virtual-service-canary.yml</code> in the <code>~/keptn/repositories/k8s-deploy-production/istio</code> repository and to apply it.</p>

<pre><code class="language-console">$ pwd
~/repositories/k8s-deploy-production/istio
$ vi virtual-service-canary.yml
...
</code></pre>

<p>Edit the file like this:</p>

<p><strong>!Note! YOU MUST NOT DELETE THE COMMENTS #v1 AND #v2 - THE COMMENTS ARE NEEDED LATER ON</strong></p>

<figure style="width:100%">
    <div class="wrapper-with-intrinsic-ratio" style="padding-bottom:%">
        <a data-lightbox="lightbox" class="not-for-endnotes" href="/docs/0.1.0/usecases/production-deployments/./assets/modify-canary-yml.png" title="Modify canary">
            <img class='popup-image element-to-stretch' src="/docs/0.1.0/usecases/production-deployments/./assets/modify-canary-yml.png" alt="Modify canary" />
        </a>
    </div>
    <figcaption>Modify canary</figcaption>
</figure>


<p>This configuration redirects 10% of all traffic hitting the sockshop <strong>VirtualService</strong> to version 2.</p></li>

<li><p>Apply the changes by executing the command <code>kubectl apply -f virtual_service_canary.yml</code></p>

<pre><code class="language-console">$ kubectl apply -f virtual_service_canary.yml
virtualservice.networking.istio.io/sockshop configured
</code></pre></li>

<li><p>To verify the configuration change, open the ingress gateway and refresh the page a couple of times. You should notice that about every tenth hit redirects you to the new version (<em>v2</em>) showing a blue header.</p></li>
</ol>

<h3 id="optional-redirect-only-logged-in-users">(optional) Redirect only logged in users</h3>

<ol>
<li><p>You can decide traffic routing also based on information that is included in the HTTP header. For example, you can present <em>v2</em> only to users that are logged in. See the following configuration that enables that:</p>

<p>```yaml
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
name: sockshop
spec:
hosts:</p>

<ul>
<li>&ldquo;*&rdquo;
gateways:</li>
<li>sockshop-gateway
http:</li>
<li>match:

<ul>
<li>headers:
cookie:
regex: &ldquo;.<em>logged_in.</em>&ldquo;
route:</li>
<li>destination:
host: front-end.production.svc.cluster.local
subset: v2</li>
</ul></li>
<li>route:

<ul>
<li>destination:
host: front-end.production.svc.cluster.local
subset: v1
```</li>
</ul></li>
</ul>

<p>Istio checks if the cookie field of the HTTP header contains the string <code>logged_in</code> using regular expressions. This, of course, depends on the implementation of your web application and is not universally applicable.</p></li>

<li><p>Apply the changes by executing the command <code>kubectl apply -f virtual_service_v2_for_users.yml</code></p>

<pre><code class="language-console">$ kubectl apply -f virtual_service_v2_for_users.yml
virtualservice.networking.istio.io/sockshop configured
</code></pre></li>

<li><p>If you login using either a new registered user, or a user that you&rsquo;ve created before, you see version 2. After logging out, you see verison 1 again.</p></li>
</ol>

<h3 id="optional-redirect-only-chrome-users">(optional) Redirect only Chrome users</h3>

<ol>
<li><p>Another option is to redirect traffic based on the used browser. See the following configuration that enables that:</p>

<p>```yaml
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
name: sockshop
spec:
hosts:</p>

<ul>
<li>&ldquo;*&rdquo;
gateways:</li>
<li>sockshop-gateway
http:</li>
<li>match:

<ul>
<li>headers:
user-agent:
regex: &ldquo;.<em>Chrome.</em>&ldquo;
route:</li>
<li>destination:
host: front-end.production.svc.cluster.local
subset: v2</li>
</ul></li>
<li>route:

<ul>
<li>destination:
host: front-end.production.svc.cluster.local
subset: v1
```</li>
</ul></li>
</ul></li>

<li><p>Apply the changes by executing the command <code>kubectl apply -f virtual_service_v2_for_chrome.yml</code></p>

<pre><code class="language-console">$ kubectl apply -f virtual_service_v2_for_chrome.yml
virtualservice.networking.istio.io/sockshop configured
</code></pre></li>

<li><p>If you open sockshop using Chrome you see version 2, with any other browser version 1 is displayed.</p></li>
</ol>

<h2 id="step-6-cleanup">Step 6. Cleanup</h2>

<ol>
<li><p>Apply the configuration of the <strong>VirtualService</strong> to use v1 only.</p>

<pre><code class="language-console">$ cd ~/keptn/repositories/k8s-deploy-production/istio
$ kubectl apply -f virtual_service.yml
virtualservice.networking.istio.io/sockshop configured
</code></pre></li>
</ol>

<h2 id="understanding-what-happened">Understanding what happened</h2>

<p>In this use case, you deployed a new service version into production and used Istio to redirect traffic towards the new and old version.</p>




            
        </main>

        
            <div class="pagenav">
                <div class="left">
                    
                        <p>
                            <a title="Shows you how to setup a fully automated on-demand self-service model for performance testing." href="https://keptn.sh/docs/0.1.0/usecases/performance-as-a-service/"><svg class="icon"><use xlink:href="/img/icons.svg#left-arrow"/></svg>Performance as a Service</a>
                        </p>
                    
                </div>
                <div class="right">
                    
                        <p>
                            <a title="Gives an overview of how to leverage the power of runbook automation to build self-healing applications. Therefore, you will use Ansible Tower as the tool for executing and managing the runbooks." href="https://keptn.sh/docs/0.1.0/usecases/runbook-automation-and-self-healing/">Runbook Automation and Self-healing<svg class="icon"><use xlink:href="/img/icons.svg#right-arrow"/></svg></a>
                        </p>
                    
                </div>
            </div>
        

        <div class="link-endnotes" aria-hidden="true">
            <h2></h2>
            <ol id="endnotes"></ol>
        </div>
    </div>

    
        <div class="toc-container">
            <nav class="toc">
                <div class="spacer"></div>
                <div id="toc" class="directory" role="directory">
                    











    
    

    
        
        <nav id="TableOfContents">
            <ul>
                
                
                    
                    
                    
                    

                    

                    <li><a href="#about-this-use-case">About this use case</a></li>

                    
                
                    
                    
                    
                    

                    

                    <li><a href="#step-1-verify-istio-installation-and-deploy-sockshop-to-production">Step 1: Verify Istio installation and deploy sockshop to production</a></li>

                    
                
                    
                    
                    
                    

                    

                    <li><a href="#step-2-access-ingress-gateway">Step 2: Access ingress gateway</a></li>

                    
                
                    
                    
                    
                    

                    

                    <li><a href="#step-3-create-front-end-v2">Step 3. Create front-end v2</a></li>

                    
                
                    
                    
                    
                    

                    

                    <li><a href="#step-4-deploy-front-end-v2-to-production">Step 4. Deploy front-end v2 to production</a></li>

                    
                
                    
                    
                    
                    

                    

                    <li><a href="#step-5-istio-traffic-routing">Step 5. Istio traffic routing</a></li>

                    
                
                    
                    
                    
                    

                    
                        
                        
                            <ul>
                        
                    

                    <li><a href="#optional-redirect-only-logged-in-users">(optional) Redirect only logged in users</a></li>

                    
                
                    
                    
                    
                    

                    

                    <li><a href="#optional-redirect-only-chrome-users">(optional) Redirect only Chrome users</a></li>

                    
                
                    
                    
                    
                    

                    
                        
                        
                            </ul>
                        
                    

                    <li><a href="#step-6-cleanup">Step 6. Cleanup</a></li>

                    
                
                    
                    
                    
                    

                    

                    <li><a href="#understanding-what-happened">Understanding what happened</a></li>

                    
                

                
                

                
            </ul>
        </nav>
    


                </div>
            </nav>
        </div>
    
</div>

</div>


  </div>

  <div class="footer fixed-bottom">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="footer-inner">
          <span class="footer-title">Built with <span style="font-size: 1.2rem">&#x2665;</span> <a href="https://dynatrace.com" target="_blank">by Dynatrace</a></span>
          <ul class="list-inline float-right">
            <li class="list-inline-item"><a href="https://github.com/keptn/" target="_blank"><img alt="github" src="https://keptn.sh/social/github.svg" /></a></li>
            <li class="list-inline-item"><a href="https://keptn.slack.com/" target="_blank"><img alt="slack" src="https://keptn.sh/social/slack.svg" /></a></li>
            <li class="list-inline-item"><a href="https://twitter.com/keptnproject" target="_blank"><img alt="twitter" src="https://keptn.sh/social/twitter.svg" /></a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>


  
  
  
  
  
  
  
  

  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>

  
  <script type="text/javascript" src="/js/scripts.min.6d111557349b327a23f49ebbca651db173a6db206c8251e177fc4ffa955c2831.js"></script>
  <script type="text/javascript" src="/js/libs/doc/utils.min.e4f6edf1fb4538897beb4a38589df56162c9a3786e26dcac1eba43e5f136f104.js"></script>
  <script type="text/javascript" src="/js/libs/doc/misc.min.76f0d57934a8cd0af0de878d8495a12e74946ee43516abbce38dd20aab5c140d.js"></script>
  <script type="text/javascript" src="/js/libs/doc/prism.min.ccc0e2507ebaf84f84a022e4628fd98c50c9c636e3c447653b6c813f04258344.js"></script>
  <script type="text/javascript" src="/js/libs/doc/lightbox/js/lightbox-plus-jquery.min.min.caa0181254e65ca8b51c5db7115641bd56796eeb7236589c6d6e1785cfb37e9d.js"></script>
  

  

  
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-133584243-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
  
    gtag('config', 'UA-133584243-1');
  </script>



</body>

</html>